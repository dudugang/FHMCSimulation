\hypertarget{classtmmc}{\section{tmmc Class Reference}
\label{classtmmc}\index{tmmc@{tmmc}}
}


Transition Matrix Monte Carlo biasing class.  




{\ttfamily \#include $<$bias.\-h$>$}

\subsection*{Public Member Functions}
\begin{DoxyCompactItemize}
\item 
\hyperlink{classtmmc_a2dd6a666daae3a9b7c3978d8ecff887e}{tmmc} ()
\item 
\hyperlink{classtmmc_ae09ec510cf4ba97b612fa0b42b811d20}{tmmc} (const int Nmax, const int Nmin, const int Mtot, const long long int tmmc\-Sweep\-Size, const std\-::vector$<$ double $>$ box)
\begin{DoxyCompactList}\small\item\em Initialize the tmmc object. \end{DoxyCompactList}\item 
void \hyperlink{classtmmc_ae067afc5b52af203b9d45f18d9737219}{update\-C} (const int Nstart, const int Nend, const int Mstart, const int Mend, const double pa)
\begin{DoxyCompactList}\small\item\em Update the collection matrix. \end{DoxyCompactList}\item 
void \hyperlink{classtmmc_a8e065523e9cc3c9628f91d3804cd201e}{calculate\-P\-I} ()
\begin{DoxyCompactList}\small\item\em Calculate the (natural logarithm of the) macrostate density matrix via the probability matrix. \end{DoxyCompactList}\item 
void \hyperlink{classtmmc_ad49e147dc88b3e1c2975269598f94327}{print} (const std\-::string file\-Name, bool print\-C=false, bool print\-H\-C=false)
\begin{DoxyCompactList}\small\item\em Print the U\-N-\/\-N\-O\-R\-M\-A\-L\-I\-Z\-E\-D biasing function (ln\-P\-I) and possibly collection matrix to files. \end{DoxyCompactList}\item 
void \hyperlink{classtmmc_a7d9ee0505dc801cbff55bc35c3654a61}{read\-C} (const std\-::string file\-Name)
\begin{DoxyCompactList}\small\item\em Read the collection matrix from a file. \end{DoxyCompactList}\item 
void \hyperlink{classtmmc_ab51a593d041a65c4ca47e6c4e0c26992}{read\-H\-C} (const std\-::string file\-Name)
\begin{DoxyCompactList}\small\item\em Read the visited states matrix from a file. \end{DoxyCompactList}\item 
void \hyperlink{classtmmc_a416db4e54e3d2ab23daed2e33468df4d}{setln\-P\-I} (const std\-::vector$<$ double $>$ \&ln\-P\-Iguess)
\begin{DoxyCompactList}\small\item\em Blindly assign a guess of the macrostate distribution. \end{DoxyCompactList}\item 
void \hyperlink{classtmmc_a611b5a86b3887afd9e90e2e4da66de35}{iterate\-Forward} ()
\begin{DoxyCompactList}\small\item\em Reset the visited state counter which tracks the number of times each point in the collection matrix has been visited. \end{DoxyCompactList}\item 
void \hyperlink{classtmmc_a295886d2f7a947a9de890bcb3adb51c7}{dump\-Visited} (const std\-::string file\-Name)
\begin{DoxyCompactList}\small\item\em Dump the current visited states counter. \end{DoxyCompactList}\item 
bool \hyperlink{classtmmc_aa51f03f958dabefcff97be4a7c3b336c}{check\-Fully\-Visited} ()
\begin{DoxyCompactList}\small\item\em Check if the the collection matrix has been samples sufficiently, i.\-e., if each state and transition has been visited tmmc\-Sweep\-Size\-\_\- times. \end{DoxyCompactList}\item 
const long long int \hyperlink{classtmmc_a8649336b47195c6ad50c437ff1f443e3}{get\-Transition\-Address} (const int Nstart, const int Nend, const int Mstart, const int Mend)
\begin{DoxyCompactList}\small\item\em For a given multidimensional array which has been cast into 1\-D, find the address that refers to a given transition. \end{DoxyCompactList}\item 
const long long int \hyperlink{classtmmc_a3e19bc0fd6a06aea2d1c23563c441eba}{get\-Address} (const int Nval, const int Mval)
\begin{DoxyCompactList}\small\item\em Get the address in ln\-P\-I that corresponds to a given macrostate. \end{DoxyCompactList}\item 
const long long int \hyperlink{classtmmc_afbdc037dc9b941d71d7049855e18f4be}{num\-Sweeps} ()
\item 
const double \hyperlink{classtmmc_afbcaaf974280aad6d78ca7e112438641}{get\-Bias} (const int address)
\item 
const std\-::vector$<$ double $>$ \hyperlink{classtmmc_a281634902422824ca2905fad6478f0c0}{get\-C} ()
\begin{DoxyCompactList}\small\item\em Return the collection matrix as it is. \end{DoxyCompactList}\item 
const std\-::vector$<$ double $>$ \hyperlink{classtmmc_a9e61aead97aef135db0895e749186f47}{get\-H\-C} ()
\end{DoxyCompactItemize}


\subsection{Detailed Description}
Transition Matrix Monte Carlo biasing class. 

Definition at line 21 of file bias.\-h.



\subsection{Constructor \& Destructor Documentation}
\hypertarget{classtmmc_a2dd6a666daae3a9b7c3978d8ecff887e}{\index{tmmc@{tmmc}!tmmc@{tmmc}}
\index{tmmc@{tmmc}!tmmc@{tmmc}}
\subsubsection[{tmmc}]{\setlength{\rightskip}{0pt plus 5cm}tmmc\-::tmmc (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [inline]}}}\label{classtmmc_a2dd6a666daae3a9b7c3978d8ecff887e}


Definition at line 23 of file bias.\-h.


\begin{DoxyCode}
23 \{\};
\end{DoxyCode}
\hypertarget{classtmmc_ae09ec510cf4ba97b612fa0b42b811d20}{\index{tmmc@{tmmc}!tmmc@{tmmc}}
\index{tmmc@{tmmc}!tmmc@{tmmc}}
\subsubsection[{tmmc}]{\setlength{\rightskip}{0pt plus 5cm}tmmc\-::tmmc (
\begin{DoxyParamCaption}
\item[{const int}]{Nmax, }
\item[{const int}]{Nmin, }
\item[{const int}]{Mtot, }
\item[{const long long int}]{tmmc\-Sweep\-Size, }
\item[{const std\-::vector$<$ double $>$}]{box}
\end{DoxyParamCaption}
)}}\label{classtmmc_ae09ec510cf4ba97b612fa0b42b811d20}


Initialize the tmmc object. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em Nmax} & Upper bound for total number of particles. \\
\hline
\mbox{\tt in}  & {\em Nmin} & Lower bound for total number of particles. \\
\hline
\mbox{\tt in}  & {\em Mtot} & Total number of expanded ensemble states in a system. \\
\hline
\mbox{\tt in}  & {\em tmmc\-Sweep\-Size} & Number of times the each point in the collection matrix must be visited for a \char`\"{}sweep\char`\"{} to be considered finished \\
\hline
\mbox{\tt in}  & {\em box} & Vector of simulations box dimensions. \\
\hline
\end{DoxyParams}


Definition at line 12 of file bias.\-cpp.


\begin{DoxyCode}
12                                                                                                            
                       \{
13     \textcolor{keywordflow}{if} (Nmin > Nmax) \{
14         \textcolor{keywordflow}{throw} \hyperlink{classcustom_exception}{customException} (\textcolor{stringliteral}{"Nmin ("}+std::to\_string(Nmin)+\textcolor{stringliteral}{") > Nmax ("}+std::to\_string(
      Nmax)+\textcolor{stringliteral}{" in TMMC bias"});
15     \}
16     \textcolor{keywordflow}{if} (Nmin < 0) \{
17         \textcolor{keywordflow}{throw} \hyperlink{classcustom_exception}{customException} (\textcolor{stringliteral}{"Nmin < 0 in TMMC bias"});
18     \}
19     \textcolor{keywordflow}{if} (Mtot < 1) \{
20         \textcolor{keywordflow}{throw} \hyperlink{classcustom_exception}{customException} (\textcolor{stringliteral}{"Mtot < 1 in TMMC bias"});
21     \}
22 
23     \textcolor{keywordtype}{long} \textcolor{keywordtype}{long} \textcolor{keywordtype}{int} size = (Nmax - Nmin + 1);
24     Nmin\_ = Nmin;
25     Nmax\_ = Nmax;
26     Mtot\_ = Mtot;
27 
28     \textcolor{keywordflow}{if} (box.size() != 3) \{
29         \textcolor{keywordflow}{throw} \hyperlink{classcustom_exception}{customException} (\textcolor{stringliteral}{"Illegal number of box dimensions in TMMC"});
30     \}
31     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} i = 0; i < box.size(); ++i) \{
32         \textcolor{keywordflow}{if} (box[i] < 0) \{
33             \textcolor{keywordflow}{throw} \hyperlink{classcustom_exception}{customException} (\textcolor{stringliteral}{"Illegal box dimensions in TMMC"});
34         \}
35     \}
36     box\_.resize(3, 0);
37     box\_ = box;
38 
39     nSweeps\_ = 0;
40     \textcolor{keywordflow}{if} (tmmcSweepSize < 1) \{
41         \textcolor{keywordflow}{throw} \hyperlink{classcustom_exception}{customException} (\textcolor{stringliteral}{"TMMC sweep size must be >= 1"});
42     \}
43     tmmcSweepSize\_ = tmmcSweepSize;
44 
45     \textcolor{comment}{// attempt to allocate memory for collection matrix and initializes it all to 0}
46     \textcolor{keywordflow}{try} \{
47         C\_.resize(3*Mtot\_*size, 0);
48     \} \textcolor{keywordflow}{catch} (\textcolor{keyword}{const} std::bad\_alloc &ce) \{
49         \textcolor{keywordflow}{throw} \hyperlink{classcustom_exception}{customException} (\textcolor{stringliteral}{"Out of memory, cannot allocate space for collection matrix
       in tmmc"});
50     \}
51 
52     \textcolor{comment}{// attempt to allocate memory for probability matrix and initializes it all to 0}
53     \textcolor{keywordflow}{try} \{
54         P\_.resize(3*Mtot\_*size, 0);
55     \} \textcolor{keywordflow}{catch} (\textcolor{keyword}{const} std::bad\_alloc &ce) \{
56         \textcolor{keywordflow}{throw} \hyperlink{classcustom_exception}{customException} (\textcolor{stringliteral}{"Out of memory, cannot allocate space for probability matrix
       in tmmc"});
57     \}
58 
59     \textcolor{comment}{// attempt to allocate memory for states counter to check how often a sweep has been performed}
60     \textcolor{keywordflow}{try} \{
61         HC\_.resize(3*Mtot\_*size, 0);
62     \} \textcolor{keywordflow}{catch} (\textcolor{keyword}{const} std::bad\_alloc &ce) \{
63         \textcolor{keywordflow}{throw} \hyperlink{classcustom_exception}{customException} (\textcolor{stringliteral}{"Out of memory, cannot allocate space for the sweep counter
       in tmmc"});
64     \}
65 
66     \textcolor{comment}{// attempt to allocate memory for lnPI matrix and initializes it all to 0}
67     \textcolor{keywordflow}{try} \{
68         lnPI\_.resize(Mtot\_*size, 0.0);
69     \} \textcolor{keywordflow}{catch} (\textcolor{keyword}{const} std::bad\_alloc &ce) \{
70         \textcolor{keywordflow}{throw} \hyperlink{classcustom_exception}{customException} (\textcolor{stringliteral}{"Out of memory, cannot allocate space for macrostate
       distribution matrix in tmmc"});
71     \}
72 \}
\end{DoxyCode}


\subsection{Member Function Documentation}
\hypertarget{classtmmc_a8e065523e9cc3c9628f91d3804cd201e}{\index{tmmc@{tmmc}!calculate\-P\-I@{calculate\-P\-I}}
\index{calculate\-P\-I@{calculate\-P\-I}!tmmc@{tmmc}}
\subsubsection[{calculate\-P\-I}]{\setlength{\rightskip}{0pt plus 5cm}void tmmc\-::calculate\-P\-I (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}}\label{classtmmc_a8e065523e9cc3c9628f91d3804cd201e}


Calculate the (natural logarithm of the) macrostate density matrix via the probability matrix. 



Definition at line 239 of file bias.\-cpp.



References get\-Transition\-Address().



Referenced by checkpoint\-::load(), perform\-Crossover(), and perform\-T\-M\-M\-C().


\begin{DoxyCode}
239                         \{
240     \textcolor{keyword}{const} \textcolor{keywordtype}{int} endPoint = C\_.size() - (Mtot\_-1)*3;
241     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{long} \textcolor{keywordtype}{long} \textcolor{keywordtype}{int} i = 0; i < endPoint; i += 3) \{
242         \textcolor{keywordtype}{double} sum = 0.0;
243         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} j = 0; j < 3; ++j) \{
244             sum += C\_[i+j];
245         \}
246         \textcolor{keywordflow}{if} (sum > 0) \{
247             \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} j = 0; j < 3; ++j) \{
248                 P\_[i+j] = C\_[i+j] / sum;
249             \}
250         \} \textcolor{keywordflow}{else} \{
251             \textcolor{comment}{// This state has not been visited at all if sum = 0.  However, at high system densities this
       could be the "correct" result so this error may need to be discarded later in favor of: P\_[i+j] = 0;}
252             \textcolor{comment}{// However, having this throw an exception is also a good way to find that upper bound where
       the system is completely packed so I will keep it this way for now.}
253             \textcolor{comment}{// Under current philosophy of a "sweep" requiring all entries in C to be filled with finite
       values, this is acutally protected against.}
254             \textcolor{keywordflow}{throw} \hyperlink{classcustom_exception}{customException} (\textcolor{stringliteral}{"Cannot compute TMMC macrostate distribution because
       probability matrix contains zeros"});
255         \}
256     \}
257 
258     \textcolor{comment}{// Reset first value to zero just to start fresh. Since only ratios matter this is perfectly fair.}
259     lnPI\_[0] = 0.0;
260     \textcolor{keywordtype}{int} counter = 0;
261     \textcolor{keywordtype}{long} \textcolor{keywordtype}{long} \textcolor{keywordtype}{int} address1 = 0, address2 = 0, nStartForward = 0, mStartForward = 0, nEndForward = 0, 
      mEndForward = 0, nStartBackward = 0, nEndBackward = 0, mStartBackward = 0, mEndBackward = 0;
262     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{long} \textcolor{keywordtype}{long} \textcolor{keywordtype}{int} i = 0; i < (Nmax\_ - Nmin\_); ++i) \{ \textcolor{comment}{// Don't calculate the last N = Nmax when M > 0,
       stops initially at N = Nmax, M = 0}
263         nStartForward = Nmin\_+i;
264         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{long} \textcolor{keywordtype}{long} \textcolor{keywordtype}{int} j = 0; j < Mtot\_; ++j) \{
265             mStartForward = j;
266             \textcolor{keywordflow}{if} (j == Mtot\_-1) \{
267                 nEndForward = nStartForward + 1;
268                 mEndForward = 0;
269             \} \textcolor{keywordflow}{else} \{
270                 nEndForward = nStartForward;
271                 mEndForward = j + 1;
272             \}
273 
274             nStartBackward = nEndForward;
275             nEndBackward = nStartForward;
276             mStartBackward = mEndForward;
277             mEndBackward = mStartForward;
278 
279             address1 = \hyperlink{classtmmc_a8649336b47195c6ad50c437ff1f443e3}{getTransitionAddress}(nStartForward, nEndForward, mStartForward, 
      mEndForward);
280             address2 = \hyperlink{classtmmc_a8649336b47195c6ad50c437ff1f443e3}{getTransitionAddress}(nStartBackward, nEndBackward, 
      mStartBackward, mEndBackward);
281 
282             \textcolor{keywordflow}{if} (!(P\_[address1] > 0) || !(P\_[address2] > 0)) \{
283                 \textcolor{keywordflow}{throw} \hyperlink{classcustom_exception}{customException} (\textcolor{stringliteral}{"Cannot compute TMMC macrostate distribution because
       probability matrix contains zeros at address: P["}+std::to\_string(address1)+\textcolor{stringliteral}{"] = "}+std::to\_string(P\_[address1
      ])+\textcolor{stringliteral}{", P["}+std::to\_string(address2)+\textcolor{stringliteral}{"] = "}+std::to\_string(P\_[address2]));
284             \}
285             lnPI\_[counter+1] = lnPI\_[counter] + log(P\_[address1]/P\_[address2]); \textcolor{comment}{// This is why P\_ cannot be
       zero}
286             counter++;
287         \}
288     \}
289 \}
\end{DoxyCode}
\hypertarget{classtmmc_aa51f03f958dabefcff97be4a7c3b336c}{\index{tmmc@{tmmc}!check\-Fully\-Visited@{check\-Fully\-Visited}}
\index{check\-Fully\-Visited@{check\-Fully\-Visited}!tmmc@{tmmc}}
\subsubsection[{check\-Fully\-Visited}]{\setlength{\rightskip}{0pt plus 5cm}bool tmmc\-::check\-Fully\-Visited (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}}\label{classtmmc_aa51f03f958dabefcff97be4a7c3b336c}


Check if the the collection matrix has been samples sufficiently, i.\-e., if each state and transition has been visited tmmc\-Sweep\-Size\-\_\- times. 



Definition at line 100 of file bias.\-cpp.



Referenced by perform\-Crossover(), and perform\-T\-M\-M\-C().


\begin{DoxyCode}
100                               \{
101     \textcolor{keyword}{const} \textcolor{keywordtype}{int} endPoint = HC\_.size() - (Mtot\_-1)*3; \textcolor{comment}{// we don't care about the last chunk where N = Nmax,
       but M > 0 - stop at N = Nmax, M = 0}
102     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{long} \textcolor{keywordtype}{long} \textcolor{keywordtype}{int} i = 0; i < endPoint; i += 3) \{
103         \textcolor{keywordflow}{if} (i == 0) \{
104             \textcolor{comment}{// lower bound, so only +1 and 0 moves must be sampled}
105             \textcolor{keywordflow}{if} ((HC\_[i+1] < tmmcSweepSize\_) || (HC\_[i] < tmmcSweepSize\_)) \{
106                 \textcolor{keywordflow}{return} \textcolor{keyword}{false};
107             \}
108         \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (i == endPoint-3) \{
109             \textcolor{comment}{// upper bound, so only -1 and 0 moves must be sampled}
110             \textcolor{keywordflow}{if} ((HC\_[i] < tmmcSweepSize\_) || (HC\_[i+2] < tmmcSweepSize\_)) \{
111                 \textcolor{keywordflow}{return} \textcolor{keyword}{false};
112             \}
113         \} \textcolor{keywordflow}{else} \{
114             \textcolor{comment}{// midpoints, both +1 and -1 (and 0) moves must be sampled}
115             \textcolor{keywordflow}{if} ((HC\_[i] < tmmcSweepSize\_) || (HC\_[i+1] < tmmcSweepSize\_) || (HC\_[i+2] < tmmcSweepSize\_)) \{
116                 \textcolor{keywordflow}{return} \textcolor{keyword}{false};
117             \}
118         \}
119     \}
120 
121     \textcolor{keywordflow}{return} \textcolor{keyword}{true};
122 \}
\end{DoxyCode}
\hypertarget{classtmmc_a295886d2f7a947a9de890bcb3adb51c7}{\index{tmmc@{tmmc}!dump\-Visited@{dump\-Visited}}
\index{dump\-Visited@{dump\-Visited}!tmmc@{tmmc}}
\subsubsection[{dump\-Visited}]{\setlength{\rightskip}{0pt plus 5cm}void tmmc\-::dump\-Visited (
\begin{DoxyParamCaption}
\item[{const std\-::string}]{file\-Name}
\end{DoxyParamCaption}
)}}\label{classtmmc_a295886d2f7a947a9de890bcb3adb51c7}


Dump the current visited states counter. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em filename} & Name of file to print to. Prints in column format. \\
\hline
\end{DoxyParams}


Definition at line 79 of file bias.\-cpp.



Referenced by perform\-Crossover(), and print().


\begin{DoxyCode}
79                                                 \{
80     std::ofstream of;
81     std::string name = fileName+\textcolor{stringliteral}{".dat"};
82     of.open(name.c\_str(), std::ofstream::out);
83     \textcolor{keywordflow}{if} (!of.is\_open()) \{
84         \textcolor{keywordflow}{throw} \hyperlink{classcustom_exception}{customException} (\textcolor{stringliteral}{"Unable to write TMMC visited states matrix to "}+name);
85     \}
86     of << \textcolor{stringliteral}{"# TMMC visited states counter in single row (vectorized) notation."} << std::endl;
87     of << \textcolor{stringliteral}{"# species\_total\_upper\_bound: "} << Nmax\_ << std::endl;
88     of << \textcolor{stringliteral}{"# species\_total\_lower\_bound: "} << Nmin\_ << std::endl;
89     \textcolor{keywordtype}{double} V = box\_[0]*box\_[1]*box\_[2];
90     of << \textcolor{stringliteral}{"# volume: "} << std::setprecision(15) << V << std::endl;
91     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{long} \textcolor{keywordtype}{long} \textcolor{keywordtype}{int} i = 0; i < HC\_.size(); ++i) \{
92         of << std::setprecision(15) << HC\_[i] << std::endl;
93     \}
94     of.close();
95 \}
\end{DoxyCode}
\hypertarget{classtmmc_a3e19bc0fd6a06aea2d1c23563c441eba}{\index{tmmc@{tmmc}!get\-Address@{get\-Address}}
\index{get\-Address@{get\-Address}!tmmc@{tmmc}}
\subsubsection[{get\-Address}]{\setlength{\rightskip}{0pt plus 5cm}const long long int tmmc\-::get\-Address (
\begin{DoxyParamCaption}
\item[{const int}]{Nval, }
\item[{const int}]{Mval}
\end{DoxyParamCaption}
)}}\label{classtmmc_a3e19bc0fd6a06aea2d1c23563c441eba}


Get the address in ln\-P\-I that corresponds to a given macrostate. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em Nval} & Number of total atoms \\
\hline
\mbox{\tt in}  & {\em Mval} & Value of expanded ensemble state \\
\hline
\end{DoxyParams}


Definition at line 199 of file bias.\-cpp.



Referenced by calculate\-Bias().


\begin{DoxyCode}
199                                                                     \{
200     \textcolor{keywordflow}{if} (Nval > Nmax\_ || Nval < Nmin\_ || Mval < 0 || Mval > Mtot\_-1) \{
201         \textcolor{keywordflow}{throw} \hyperlink{classcustom_exception}{customException} (\textcolor{stringliteral}{"N, M out of bounds in TMMC object, cannot retrieve address"})
      ;
202     \}
203     \textcolor{keywordflow}{return} (Nval - Nmin\_)*Mtot\_ + Mval;
204 \}
\end{DoxyCode}
\hypertarget{classtmmc_afbcaaf974280aad6d78ca7e112438641}{\index{tmmc@{tmmc}!get\-Bias@{get\-Bias}}
\index{get\-Bias@{get\-Bias}!tmmc@{tmmc}}
\subsubsection[{get\-Bias}]{\setlength{\rightskip}{0pt plus 5cm}const double tmmc\-::get\-Bias (
\begin{DoxyParamCaption}
\item[{const int}]{address}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [inline]}}}\label{classtmmc_afbcaaf974280aad6d78ca7e112438641}


Definition at line 38 of file bias.\-h.



Referenced by calculate\-Bias().


\begin{DoxyCode}
38 \{ \textcolor{keywordflow}{return} -lnPI\_[address]; \}
\end{DoxyCode}
\hypertarget{classtmmc_a281634902422824ca2905fad6478f0c0}{\index{tmmc@{tmmc}!get\-C@{get\-C}}
\index{get\-C@{get\-C}!tmmc@{tmmc}}
\subsubsection[{get\-C}]{\setlength{\rightskip}{0pt plus 5cm}const std\-::vector$<$ double $>$ tmmc\-::get\-C (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [inline]}}}\label{classtmmc_a281634902422824ca2905fad6478f0c0}


Return the collection matrix as it is. 



Definition at line 39 of file bias.\-h.

\hypertarget{classtmmc_a9e61aead97aef135db0895e749186f47}{\index{tmmc@{tmmc}!get\-H\-C@{get\-H\-C}}
\index{get\-H\-C@{get\-H\-C}!tmmc@{tmmc}}
\subsubsection[{get\-H\-C}]{\setlength{\rightskip}{0pt plus 5cm}const std\-::vector$<$ double $>$ tmmc\-::get\-H\-C (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [inline]}}}\label{classtmmc_a9e61aead97aef135db0895e749186f47}


Definition at line 40 of file bias.\-h.


\begin{DoxyCode}
40 \{ \textcolor{keywordflow}{return} HC\_; \}
\end{DoxyCode}
\hypertarget{classtmmc_a8649336b47195c6ad50c437ff1f443e3}{\index{tmmc@{tmmc}!get\-Transition\-Address@{get\-Transition\-Address}}
\index{get\-Transition\-Address@{get\-Transition\-Address}!tmmc@{tmmc}}
\subsubsection[{get\-Transition\-Address}]{\setlength{\rightskip}{0pt plus 5cm}const long long int tmmc\-::get\-Transition\-Address (
\begin{DoxyParamCaption}
\item[{const int}]{Nstart, }
\item[{const int}]{Nend, }
\item[{const int}]{Mstart, }
\item[{const int}]{Mend}
\end{DoxyParamCaption}
)}}\label{classtmmc_a8649336b47195c6ad50c437ff1f443e3}


For a given multidimensional array which has been cast into 1\-D, find the address that refers to a given transition. 

Assumes only valid moves are moving by +/-\/1 M (and subsequently N), will throw exception if this is not met.


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em Nstart} & Number of total species initially (before M\-C move) \\
\hline
\mbox{\tt in}  & {\em Nend} & Number of total species (in order) after the M\-C move \\
\hline
\mbox{\tt in}  & {\em Mstart} & Expanded ensemble state the system begins in \\
\hline
\mbox{\tt in}  & {\em Mend} & Expanded ensemble state the system ends in \\
\hline
\end{DoxyParams}


Definition at line 141 of file bias.\-cpp.



Referenced by calculate\-P\-I(), and update\-C().


\begin{DoxyCode}
141                                                                                                            
             \{
142     \textcolor{keywordflow}{if} (Nstart > Nmax\_ || Nstart < Nmin\_ || Nend > (Nmax\_+1) || Nend < (Nmin\_-1) || Mstart < 0 || Mstart > 
      Mtot\_-1 || Mend < 0 || Mend > Mtot\_-1) \{ \textcolor{comment}{// Nend has array positions for going over end of bounds but are
       never used, still they are valid}
143         \textcolor{keywordflow}{throw} \hyperlink{classcustom_exception}{customException} (\textcolor{stringliteral}{"N, M out of bounds in TMMC object, cannot retrieve address"})
      ;
144     \}
145 
146     \textcolor{keywordflow}{if} (Mtot\_ > 1) \{
147         \textcolor{comment}{// Expanded ensemble}
148         \textcolor{keywordtype}{int} y = 0;
149         \textcolor{keywordflow}{if} (Nstart == Nend) \{
150             \textcolor{comment}{// Moving within an expanded set}
151             \textcolor{keywordtype}{int} addOrSubtract = Mend - Mstart;
152             \textcolor{keywordflow}{if} (addOrSubtract == 0) \{
153                 y = 0;
154             \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (addOrSubtract == 1) \{
155                 y = 1;
156             \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (addOrSubtract == -1) \{
157                 y = 2;
158             \} \textcolor{keywordflow}{else} \{
159                 \textcolor{keywordflow}{throw} \hyperlink{classcustom_exception}{customException} (\textcolor{stringliteral}{"Illegal addOrSubtract value"});
160             \}
161         \} \textcolor{keywordflow}{else} \{
162             \textcolor{comment}{// Crossing over}
163             \textcolor{keywordflow}{if} (Nend > Nstart) \{
164                 y = 1;
165                 \textcolor{keywordflow}{if} (Mstart != Mtot\_ - 1 || Mend != 0) \{
166                     \textcolor{keywordflow}{throw} \hyperlink{classcustom_exception}{customException} (\textcolor{stringliteral}{"Illegal expanded ensemble values"});
167                 \}
168             \} \textcolor{keywordflow}{else} \{
169                 y = 2;
170                 \textcolor{keywordflow}{if} (Mstart != 0 || Mend != (Mtot\_-1)) \{
171                     \textcolor{keywordflow}{throw} \hyperlink{classcustom_exception}{customException} (\textcolor{stringliteral}{"Illegal expanded ensemble values"});
172                 \}
173             \}
174         \}
175         \textcolor{keywordflow}{return} 3*((Nstart - Nmin\_)*Mtot\_ + Mstart) + y;
176     \} \textcolor{keywordflow}{else} \{
177         \textcolor{comment}{// No expanded ensemble}
178         \textcolor{keywordtype}{int} addOrSubtract = (Nend - Nstart), y = 0;
179         \textcolor{keywordflow}{if} (addOrSubtract == 0) \{
180             y = 0;
181         \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (addOrSubtract == 1) \{
182             y = 1;
183         \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (addOrSubtract == -1) \{
184             y = 2;
185         \} \textcolor{keywordflow}{else} \{
186             \textcolor{keywordflow}{throw} \hyperlink{classcustom_exception}{customException} (\textcolor{stringliteral}{"Illegal addOrSubtract value"});
187         \}
188         \textcolor{keywordtype}{long} \textcolor{keywordtype}{long} \textcolor{keywordtype}{int} x = Nstart - Nmin\_;
189         \textcolor{keywordflow}{return} x*3 + y; \textcolor{comment}{// Equivalent to expanded ensemble because Mstart = 0 always, and Mtot\_ = 1}
190     \}
191 \}
\end{DoxyCode}
\hypertarget{classtmmc_a611b5a86b3887afd9e90e2e4da66de35}{\index{tmmc@{tmmc}!iterate\-Forward@{iterate\-Forward}}
\index{iterate\-Forward@{iterate\-Forward}!tmmc@{tmmc}}
\subsubsection[{iterate\-Forward}]{\setlength{\rightskip}{0pt plus 5cm}void tmmc\-::iterate\-Forward (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}}\label{classtmmc_a611b5a86b3887afd9e90e2e4da66de35}


Reset the visited state counter which tracks the number of times each point in the collection matrix has been visited. 



Definition at line 127 of file bias.\-cpp.



Referenced by perform\-Crossover(), and perform\-T\-M\-M\-C().


\begin{DoxyCode}
127                            \{
128     std::fill(HC\_.begin(), HC\_.end(), 0);
129     nSweeps\_++;
130 \}
\end{DoxyCode}
\hypertarget{classtmmc_afbdc037dc9b941d71d7049855e18f4be}{\index{tmmc@{tmmc}!num\-Sweeps@{num\-Sweeps}}
\index{num\-Sweeps@{num\-Sweeps}!tmmc@{tmmc}}
\subsubsection[{num\-Sweeps}]{\setlength{\rightskip}{0pt plus 5cm}const long long int tmmc\-::num\-Sweeps (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [inline]}}}\label{classtmmc_afbdc037dc9b941d71d7049855e18f4be}


Definition at line 37 of file bias.\-h.



Referenced by perform\-Crossover().


\begin{DoxyCode}
37 \{ \textcolor{keywordflow}{return} nSweeps\_; \}
\end{DoxyCode}
\hypertarget{classtmmc_ad49e147dc88b3e1c2975269598f94327}{\index{tmmc@{tmmc}!print@{print}}
\index{print@{print}!tmmc@{tmmc}}
\subsubsection[{print}]{\setlength{\rightskip}{0pt plus 5cm}void tmmc\-::print (
\begin{DoxyParamCaption}
\item[{const std\-::string}]{file\-Name, }
\item[{bool}]{print\-C = {\ttfamily false}, }
\item[{bool}]{print\-H\-C = {\ttfamily false}}
\end{DoxyParamCaption}
)}}\label{classtmmc_ad49e147dc88b3e1c2975269598f94327}


Print the U\-N-\/\-N\-O\-R\-M\-A\-L\-I\-Z\-E\-D biasing function (ln\-P\-I) and possibly collection matrix to files. 

Will overwrite the files if another with that name exists.


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em file\-Name} & Name of the file to print to. Will append with \char`\"{}\-\_\-ln\-P\-I\char`\"{} and \char`\"{}\-\_\-\-C\char`\"{} for biasing function and collection matrix, respectively. \\
\hline
\mbox{\tt in}  & {\em print\-C} & Defaults to false, but if true will also print the collection matrix. \\
\hline
\mbox{\tt in}  & {\em print\-H\-C} & Defaults to false, but if true will also print the visited states matrix. \\
\hline
\end{DoxyParams}


Definition at line 299 of file bias.\-cpp.



References dump\-Visited().



Referenced by checkpoint\-::dump(), perform\-Crossover(), and perform\-T\-M\-M\-C().


\begin{DoxyCode}
299                                                                      \{
300     \textcolor{comment}{// Print collection matrix}
301     \textcolor{keywordflow}{if} (printC) \{
302         \textcolor{comment}{// Print all states, including partial ones, so this can be used to restart from, etc.}
303         std::ofstream of;
304         std::string name = fileName+\textcolor{stringliteral}{"\_C.dat"};
305         of.open(name.c\_str(), std::ofstream::out);
306         \textcolor{keywordflow}{if} (!of.is\_open()) \{
307             \textcolor{keywordflow}{throw} \hyperlink{classcustom_exception}{customException} (\textcolor{stringliteral}{"Unable to write TMMC collection matrix to "}+name);
308         \}
309         of << \textcolor{stringliteral}{"# Collection matrix in single row (vectorized) notation."} << std::endl;
310         of << \textcolor{stringliteral}{"# species\_total\_upper\_bound: "} << Nmax\_ << std::endl;
311         of << \textcolor{stringliteral}{"# species\_total\_lower\_bound: "} << Nmin\_ << std::endl;
312         \textcolor{keywordtype}{double} V = box\_[0]*box\_[1]*box\_[2];
313         of << \textcolor{stringliteral}{"# volume: "} << std::setprecision(15) << V << std::endl;
314         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{long} \textcolor{keywordtype}{long} \textcolor{keywordtype}{int} i = 0; i < C\_.size(); ++i) \{
315             of << std::setprecision(15) << C\_[i] << std::endl;
316         \}
317         of.close();
318     \}
319 
320     \textcolor{comment}{// Print visited states matrix}
321     \textcolor{keywordflow}{if} (printHC) \{
322         \textcolor{comment}{// print all states, including partial ones, so this can be used to restart from, etc.}
323         \hyperlink{classtmmc_a295886d2f7a947a9de890bcb3adb51c7}{dumpVisited}(fileName+\textcolor{stringliteral}{"\_HC"});
324     \}
325 
326     \textcolor{comment}{// Print lnPI (bias) matrix}
327     std::ofstream of;
328     std::string name = fileName+\textcolor{stringliteral}{"\_lnPI.dat"};
329     of.open(name.c\_str(), std::ofstream::out);
330     \textcolor{keywordflow}{if} (!of.is\_open()) \{
331         \textcolor{keywordflow}{throw} \hyperlink{classcustom_exception}{customException} (\textcolor{stringliteral}{"Unable to write TMMC lnPI to "}+name);
332     \}
333     of << \textcolor{stringliteral}{"# lnPI (bias) matrix in single row (vectorized) notation."} << std::endl;
334     of << \textcolor{stringliteral}{"# species\_total\_upper\_bound: "} << Nmax\_ << std::endl;
335     of << \textcolor{stringliteral}{"# species\_total\_lower\_bound: "} << Nmin\_ << std::endl;
336     \textcolor{keywordtype}{double} V = box\_[0]*box\_[1]*box\_[2];
337     of << \textcolor{stringliteral}{"# volume: "} << std::setprecision(15) << V << std::endl;
338     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{long} \textcolor{keywordtype}{long} \textcolor{keywordtype}{int} i = 0; i < lnPI\_.size(); i += Mtot\_) \{
339         of << std::setprecision(15) << lnPI\_[i] << std::endl; \textcolor{comment}{// only print the integral states}
340     \}
341     of.close();
342 \}
\end{DoxyCode}
\hypertarget{classtmmc_a7d9ee0505dc801cbff55bc35c3654a61}{\index{tmmc@{tmmc}!read\-C@{read\-C}}
\index{read\-C@{read\-C}!tmmc@{tmmc}}
\subsubsection[{read\-C}]{\setlength{\rightskip}{0pt plus 5cm}void tmmc\-::read\-C (
\begin{DoxyParamCaption}
\item[{const std\-::string}]{file\-Name}
\end{DoxyParamCaption}
)}}\label{classtmmc_a7d9ee0505dc801cbff55bc35c3654a61}


Read the collection matrix from a file. 

This assumes the user has already guaranteed that the bounds are consistent, e.\-g. Nmin and Nmax, as it will not check this automatically. Also assumes file was generated by this code. \char`\"{}\-Hand made\char`\"{} ones might have formatting issues since parsing is done based on tokens.


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em file\-Name} & Name of file containing the collection matrix. Must include file extension. \\
\hline
\end{DoxyParams}


Definition at line 376 of file bias.\-cpp.



Referenced by checkpoint\-::load(), and perform\-T\-M\-M\-C().


\begin{DoxyCode}
376                                           \{
377     std::ifstream infile (fileName.c\_str());
378     \textcolor{keywordflow}{if} (!infile.is\_open()) \{
379         \textcolor{keywordflow}{throw} \hyperlink{classcustom_exception}{customException}(\textcolor{stringliteral}{"Unable to read collection matrix from ASCII file "}+fileName);
380     \}
381     std::string line;
382     \textcolor{keywordtype}{int} lineIndex = 0;
383     \textcolor{keywordflow}{while}(std::getline(infile,line)) \{
384         std::stringstream lineStream(line);
385         \textcolor{comment}{// skip any header information}
386         \textcolor{keywordflow}{if} (line.compare(0,1,\textcolor{stringliteral}{"#"},0,1) != 0) \{
387             C\_[lineIndex] = atof(line.c\_str());
388             lineIndex++;
389         \}
390     \}
391     infile.close();
392 \}
\end{DoxyCode}
\hypertarget{classtmmc_ab51a593d041a65c4ca47e6c4e0c26992}{\index{tmmc@{tmmc}!read\-H\-C@{read\-H\-C}}
\index{read\-H\-C@{read\-H\-C}!tmmc@{tmmc}}
\subsubsection[{read\-H\-C}]{\setlength{\rightskip}{0pt plus 5cm}void tmmc\-::read\-H\-C (
\begin{DoxyParamCaption}
\item[{const std\-::string}]{file\-Name}
\end{DoxyParamCaption}
)}}\label{classtmmc_ab51a593d041a65c4ca47e6c4e0c26992}


Read the visited states matrix from a file. 

This assumes the user has already guaranteed that the bounds are consistent, e.\-g. Nmin and Nmax, as it will not check this automatically. Also assumes file was generated by this code. \char`\"{}\-Hand made\char`\"{} ones might have formatting issues since parsing is done based on tokens.


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em file\-Name} & Name of file containing the visited states matrix. Must include file extension. \\
\hline
\end{DoxyParams}


Definition at line 351 of file bias.\-cpp.



Referenced by checkpoint\-::load().


\begin{DoxyCode}
351                                            \{
352     std::ifstream infile (fileName.c\_str());
353     \textcolor{keywordflow}{if} (!infile.is\_open()) \{
354         \textcolor{keywordflow}{throw} \hyperlink{classcustom_exception}{customException}(\textcolor{stringliteral}{"Unable to read visited states matrix from ASCII file "}+
      fileName);
355     \}
356     std::string line;
357     \textcolor{keywordtype}{int} lineIndex = 0;
358     \textcolor{keywordflow}{while}(std::getline(infile,line)) \{
359         std::stringstream lineStream(line);
360         \textcolor{comment}{// skip any header information}
361         \textcolor{keywordflow}{if} (line.compare(0,1,\textcolor{stringliteral}{"#"},0,1) != 0) \{
362             HC\_[lineIndex] = atof(line.c\_str());
363             lineIndex++;
364         \}
365     \}
366     infile.close();
367 \}
\end{DoxyCode}
\hypertarget{classtmmc_a416db4e54e3d2ab23daed2e33468df4d}{\index{tmmc@{tmmc}!setln\-P\-I@{setln\-P\-I}}
\index{setln\-P\-I@{setln\-P\-I}!tmmc@{tmmc}}
\subsubsection[{setln\-P\-I}]{\setlength{\rightskip}{0pt plus 5cm}void tmmc\-::setln\-P\-I (
\begin{DoxyParamCaption}
\item[{const std\-::vector$<$ double $>$ \&}]{ln\-P\-Iguess}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [inline]}}}\label{classtmmc_a416db4e54e3d2ab23daed2e33468df4d}


Blindly assign a guess of the macrostate distribution. 



Definition at line 31 of file bias.\-h.

\hypertarget{classtmmc_ae067afc5b52af203b9d45f18d9737219}{\index{tmmc@{tmmc}!update\-C@{update\-C}}
\index{update\-C@{update\-C}!tmmc@{tmmc}}
\subsubsection[{update\-C}]{\setlength{\rightskip}{0pt plus 5cm}void tmmc\-::update\-C (
\begin{DoxyParamCaption}
\item[{const int}]{Nstart, }
\item[{const int}]{Nend, }
\item[{const int}]{Mstart, }
\item[{const int}]{Mend, }
\item[{const double}]{pa}
\end{DoxyParamCaption}
)}}\label{classtmmc_ae067afc5b52af203b9d45f18d9737219}


Update the collection matrix. 

This records the number of times a transition probability is measured with a finite, non-\/zero probability. This way, when \hyperlink{classtmmc_aa51f03f958dabefcff97be4a7c3b336c}{check\-Fully\-Visited()} returns true, all the ln\-P\-I values can be calculated since all transition probabilities will be finite. Otherwise, transitions could be \char`\"{}sampled\char`\"{} but if the d\-U = inf, then the collection matrix is updated with a value of 0. This could theoretically remain zero until the end of a sweep which is later caught when it creates a problem for calculating ln\-P\-I in \hyperlink{classtmmc_a8e065523e9cc3c9628f91d3804cd201e}{calculate\-P\-I()}.


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em Nstart} & Total number of atoms initially (before M\-C move) \\
\hline
\mbox{\tt in}  & {\em Nend} & Total number of atoms after the M\-C move \\
\hline
\mbox{\tt in}  & {\em Mstart} & Initial value of expanded ensemble state \\
\hline
\mbox{\tt in}  & {\em Mend} & Final value of expanded ensemble state \\
\hline
\mbox{\tt in}  & {\em pa} & Unbiased Metropolis criterion for making a M\-C move (i.\-e. pa = min(1, exp(...))) \\
\hline
\end{DoxyParams}


Definition at line 215 of file bias.\-cpp.



References get\-Transition\-Address(), and custom\-Exception\-::what().



Referenced by agg\-Vol\-Bias3\-::make(), translate\-Particle\-::make(), delete\-Particle\-::make(), insert\-Particle\-::make(), and swap\-Particles\-::make().


\begin{DoxyCode}
215                                                                                                        \{
216     \textcolor{keywordtype}{int} i = 0, j = 0;
217     \textcolor{keywordflow}{try} \{
218         i = \hyperlink{classtmmc_a8649336b47195c6ad50c437ff1f443e3}{getTransitionAddress}(Nstart, Nend, Mstart, Mend);
219     \} \textcolor{keywordflow}{catch} (\hyperlink{classcustom_exception}{customException} &ce) \{
220         \textcolor{keywordflow}{throw} \hyperlink{classcustom_exception}{customException} (\textcolor{stringliteral}{"Cannot update collection matrix: "} + std::to\_string(*ce.
      \hyperlink{classcustom_exception_aeb6ab5848b038adfc68fde86a512f691}{what}()));
221     \}
222     \textcolor{keywordflow}{try} \{
223         j = \hyperlink{classtmmc_a8649336b47195c6ad50c437ff1f443e3}{getTransitionAddress}(Nstart, Nstart, Mstart, Mstart);
224     \} \textcolor{keywordflow}{catch} (\hyperlink{classcustom_exception}{customException} &ce) \{
225         \textcolor{keywordflow}{throw} \hyperlink{classcustom_exception}{customException} (\textcolor{stringliteral}{"Cannot update collection matrix: "} + std::to\_string(*ce.
      \hyperlink{classcustom_exception_aeb6ab5848b038adfc68fde86a512f691}{what}()));
226     \}
227     C\_[i] += pa;
228     C\_[j] += (1-pa);
229     \textcolor{keywordflow}{if} (pa > 0.0) \{
230         HC\_[i] += 1.0; \textcolor{comment}{// Only count the transition actually proposed, not the Nstart --> Nstart unless
       that was what was originally proposed, and only count when transition probability is finite.}
231     \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (Nstart == 0 && Nend == 0) \{
232         HC\_[i] += 1.0; \textcolor{comment}{// Translation move when 0 particles in system is "early rejected" (p = 0), but this
       is valid - if N\_min of window is > 0 checkVisited() works fine, but if includes 0, this state is detected
       as never being sampled otherwise, which is the incorrect response}
233     \}
234 \}
\end{DoxyCode}


The documentation for this class was generated from the following files\-:\begin{DoxyCompactItemize}
\item 
/home/nam4/\-Desktop/sandbox/\-F\-H\-M\-C\-Simulation/src/\hyperlink{bias_8h}{bias.\-h}\item 
/home/nam4/\-Desktop/sandbox/\-F\-H\-M\-C\-Simulation/src/\hyperlink{bias_8cpp}{bias.\-cpp}\end{DoxyCompactItemize}
