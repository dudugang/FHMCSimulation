\hypertarget{crossover_8h}{\section{/home/nam4/\-Desktop/sandbox/\-F\-H\-M\-C\-Simulation/src/crossover.h File Reference}
\label{crossover_8h}\index{/home/nam4/\-Desktop/sandbox/\-F\-H\-M\-C\-Simulation/src/crossover.\-h@{/home/nam4/\-Desktop/sandbox/\-F\-H\-M\-C\-Simulation/src/crossover.\-h}}
}
{\ttfamily \#include $<$string$>$}\\*
{\ttfamily \#include $<$memory$>$}\\*
{\ttfamily \#include \char`\"{}system.\-h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}checkpoint.\-h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}utilities.\-h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}mover.\-h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}sanity.\-h\char`\"{}}\\*
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
void \hyperlink{crossover_8h_ac565cbacb4d42765f9cbe8da5f1f05ee}{perform\-Crossover} (\hyperlink{classsim_system}{sim\-System} \&sys, \hyperlink{classcheckpoint}{checkpoint} \&res, \hyperlink{classmoves}{moves} $\ast$used\-Moves\-Eq)
\begin{DoxyCompactList}\small\item\em Perform crossover from Wang-\/\-Landau stage of simulation to T\-M\-M\-C. \end{DoxyCompactList}\end{DoxyCompactItemize}


\subsection{Function Documentation}
\hypertarget{crossover_8h_ac565cbacb4d42765f9cbe8da5f1f05ee}{\index{crossover.\-h@{crossover.\-h}!perform\-Crossover@{perform\-Crossover}}
\index{perform\-Crossover@{perform\-Crossover}!crossover.h@{crossover.\-h}}
\subsubsection[{perform\-Crossover}]{\setlength{\rightskip}{0pt plus 5cm}void perform\-Crossover (
\begin{DoxyParamCaption}
\item[{{\bf sim\-System} \&}]{sys, }
\item[{{\bf checkpoint} \&}]{res, }
\item[{{\bf moves} $\ast$}]{used\-Moves\-Eq}
\end{DoxyParamCaption}
)}}\label{crossover_8h_ac565cbacb4d42765f9cbe8da5f1f05ee}


Perform crossover from Wang-\/\-Landau stage of simulation to T\-M\-M\-C. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em sys} & System to simulate \\
\hline
\mbox{\tt in}  & {\em res} & Restart/checkpoint information \\
\hline
\mbox{\tt in}  & {\em used\-Moves\-Eq} & Move class to use \\
\hline
\end{DoxyParams}


Definition at line 10 of file crossover.\-cpp.



References tmmc\-::calculate\-P\-I(), checkpoint\-::check(), sim\-System\-::check\-Energy\-Histogram\-Bounds(), tmmc\-::check\-Fully\-Visited(), checkpoint\-::crossover\-Done, tmmc\-::dump\-Visited(), wala\-::evaluate\-Flatness(), sim\-System\-::get\-Current\-M(), get\-Time\-Stamp(), sim\-System\-::get\-T\-M\-M\-C\-Bias(), sim\-System\-::get\-Total\-M(), sim\-System\-::get\-W\-A\-L\-A\-Bias(), tmmc\-::iterate\-Forward(), wala\-::iterate\-Forward(), wala\-::ln\-F(), moves\-::make\-Move(), checkpoint\-::move\-Counter, sim\-System\-::n\-Crossover\-Visits, tmmc\-::num\-Sweeps(), moves\-::print(), tmmc\-::print(), sim\-System\-::re\-Initialize\-Energy\-Histogram(), checkpoint\-::res\-From\-Cross, sanity\-Checks(), sim\-System\-::start\-T\-M\-M\-C(), sim\-System\-::stop\-W\-A\-L\-A(), checkpoint\-::sweep\-Counter, S\-Y\-S\-\_\-\-F\-A\-I\-L\-U\-R\-E, sim\-System\-::tmmc\-Sweep\-Size, sim\-System\-::use\-W\-A\-L\-A, custom\-Exception\-::what(), and sim\-System\-::wl\-Sweep\-Size.


\begin{DoxyCode}
10                                                                             \{
11     \textcolor{keywordflow}{if} (res.\hyperlink{classcheckpoint_a4f13612ea6d376bb327295bfce3a70c5}{crossoverDone}) \{
12         \textcolor{keywordflow}{throw} \hyperlink{classcustom_exception}{customException} (\textcolor{stringliteral}{"Checkpoint indicates crossover already finished"});
13     \}
14     std::cout << \textcolor{stringliteral}{"Crossing over to build TMMC matrix at "} << \hyperlink{utilities_8cpp_aa6d910bf51f18a75deb20c6f0fbba285}{getTimeStamp}() << std::endl;
15 
16     res.\hyperlink{classcheckpoint_a4f13612ea6d376bb327295bfce3a70c5}{crossoverDone} = \textcolor{keyword}{false};
17     \textcolor{keywordtype}{long} \textcolor{keywordtype}{long} \textcolor{keywordtype}{int} timesFullyVisited = 0, moveStart = 0;
18     \textcolor{keywordflow}{if} (!res.\hyperlink{classcheckpoint_ac3e65d26f2b8231ae9dd7e29c72ecf3b}{resFromCross}) \{
19         \textcolor{keywordflow}{if} (!sys.\hyperlink{classsim_system_aa83b00006b3919fb6e13f1bdeadece6a}{useWALA}) \{
20             \textcolor{keywordflow}{throw} \hyperlink{classcustom_exception}{customException} (\textcolor{stringliteral}{"WALA not configured, cannot proceeed with crossover"});
21         \}
22         sys.\hyperlink{classsim_system_ac689245cd8e9ddfdcd94d3871a5a5d6b}{startTMMC} (sys.\hyperlink{classsim_system_a56e284a361964d0a9ce5c45f41d56ab1}{tmmcSweepSize}, sys.\hyperlink{classsim_system_aa4ad1afff101bb530e1590df05035276}{getTotalM}());
23     \} \textcolor{keywordflow}{else} \{
24         timesFullyVisited = res.\hyperlink{classcheckpoint_ad011ddbca1ea708321335b1b3ac67e07}{sweepCounter};
25         moveStart = res.\hyperlink{classcheckpoint_a5ab49a355714da4874aba00eb03f701d}{moveCounter};
26     \}
27 
28     std::cout << \textcolor{stringliteral}{"Starting from lnF = "} << sys.\hyperlink{classsim_system_a7cb5049de8b0988349e89e30e4000407}{getWALABias}()->\hyperlink{classwala_acb8e59580d97bc3c5b9b4ff45eb6bb9a}{lnF}() << \textcolor{stringliteral}{" at "} << 
      \hyperlink{utilities_8cpp_aa6d910bf51f18a75deb20c6f0fbba285}{getTimeStamp}() << std::endl;
29     std::cout << \textcolor{stringliteral}{"Starting from "} << moveStart << \textcolor{stringliteral}{" moves in current sweep at "} << 
      \hyperlink{utilities_8cpp_aa6d910bf51f18a75deb20c6f0fbba285}{getTimeStamp}() << std::endl;
30     std::cout << \textcolor{stringliteral}{"Starting from "} << timesFullyVisited << \textcolor{stringliteral}{" out of "} << sys.
      \hyperlink{classsim_system_aa748f651ddd9a2bf6d88bfcab9153905}{nCrossoverVisits} << \textcolor{stringliteral}{" sweeps at "} << \hyperlink{utilities_8cpp_aa6d910bf51f18a75deb20c6f0fbba285}{getTimeStamp}() << std::endl;
31 
32     \textcolor{keywordflow}{while} (timesFullyVisited < sys.\hyperlink{classsim_system_aa748f651ddd9a2bf6d88bfcab9153905}{nCrossoverVisits}) \{
33         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{long} \textcolor{keywordtype}{long} \textcolor{keywordtype}{int} move = moveStart; move < sys.\hyperlink{classsim_system_ae625e1026daee4f99f83fb73881875a1}{wlSweepSize}; ++move) \{
34             \textcolor{keywordflow}{try} \{
35                 usedMovesEq->\hyperlink{classmoves_a7f023913b80bb62604b99f4dbf005c37}{makeMove}(sys);
36             \} \textcolor{keywordflow}{catch} (\hyperlink{classcustom_exception}{customException} &ce) \{
37                 std::cerr << ce.\hyperlink{classcustom_exception_aeb6ab5848b038adfc68fde86a512f691}{what}() << std::endl;
38                 exit(\hyperlink{global_8h_a428dfe1ef0a6ff4b1fdebf275f6aff2e}{SYS\_FAILURE});
39             \}
40             \textcolor{keywordflow}{if} (sys.\hyperlink{classsim_system_a299fe4372e610b554eaaf5f5957b2dbc}{getCurrentM}() == 0) \{
41                 sys.\hyperlink{classsim_system_a176b9ff482f1d36bc0638538bcfe0670}{checkEnergyHistogramBounds} ();
42             \}
43             res.\hyperlink{classcheckpoint_ab9ca7cab3fd3c5dc35fe71977b81a69f}{check}(sys, move, timesFullyVisited);
44         \}
45 
46         \textcolor{keywordflow}{if} (sys.\hyperlink{classsim_system_aa31d40c91cb50f143a9613d362798887}{getTMMCBias}()->\hyperlink{classtmmc_aa51f03f958dabefcff97be4a7c3b336c}{checkFullyVisited}()) \{
47             \textcolor{keywordflow}{try} \{
48                 sys.\hyperlink{classsim_system_aa31d40c91cb50f143a9613d362798887}{getTMMCBias}()->\hyperlink{classtmmc_a8e065523e9cc3c9628f91d3804cd201e}{calculatePI}();
49             \} \textcolor{keywordflow}{catch} (\hyperlink{classcustom_exception}{customException} &ce) \{
50                 std::cerr << ce.\hyperlink{classcustom_exception_aeb6ab5848b038adfc68fde86a512f691}{what}() << std::endl;
51                 sys.\hyperlink{classsim_system_aa31d40c91cb50f143a9613d362798887}{getTMMCBias}()->\hyperlink{classtmmc_ad49e147dc88b3e1c2975269598f94327}{print}(\textcolor{stringliteral}{"tmmc-crossover-fail"}, \textcolor{keyword}{true});
52                 sys.\hyperlink{classsim_system_aa31d40c91cb50f143a9613d362798887}{getTMMCBias}()->\hyperlink{classtmmc_a295886d2f7a947a9de890bcb3adb51c7}{dumpVisited}(\textcolor{stringliteral}{"tmmc-crossover-fail-visited"});
53                 exit(\hyperlink{global_8h_a428dfe1ef0a6ff4b1fdebf275f6aff2e}{SYS\_FAILURE});
54             \}
55             sys.\hyperlink{classsim_system_aa31d40c91cb50f143a9613d362798887}{getTMMCBias}()->\hyperlink{classtmmc_a611b5a86b3887afd9e90e2e4da66de35}{iterateForward} (); \textcolor{comment}{// reset the counting matrix and
       increment total sweep number}
56             timesFullyVisited = sys.\hyperlink{classsim_system_aa31d40c91cb50f143a9613d362798887}{getTMMCBias}()->\hyperlink{classtmmc_afbdc037dc9b941d71d7049855e18f4be}{numSweeps}();
57             std::cout << \textcolor{stringliteral}{"Times C fully visited = "} << timesFullyVisited << \textcolor{stringliteral}{" at "} << 
      \hyperlink{utilities_8cpp_aa6d910bf51f18a75deb20c6f0fbba285}{getTimeStamp}() << std::endl;
58             usedMovesEq->\hyperlink{classmoves_acc6415d4000f01b93235d1a533aa6880}{print}(\textcolor{stringliteral}{"crossover.stats"});
59         \}
60 
61         \textcolor{comment}{// Check if bias has flattened out, just for continuous improvement}
62         \textcolor{keywordtype}{bool} flat = sys.\hyperlink{classsim_system_a7cb5049de8b0988349e89e30e4000407}{getWALABias}()->\hyperlink{classwala_add6302db96fcc45811b2944de2936525}{evaluateFlatness}();
63         \textcolor{keywordflow}{if} (flat) \{
64             \textcolor{comment}{// If flat, need to reset H and reduce lnF}
65             sys.\hyperlink{classsim_system_a7cb5049de8b0988349e89e30e4000407}{getWALABias}()->\hyperlink{classwala_ae06c2f1475702ec9d1b0a243b7f34e4b}{iterateForward}();
66             std::cout << \textcolor{stringliteral}{"Wang-Landau is now flat, new lnF = "} << sys.
      \hyperlink{classsim_system_a7cb5049de8b0988349e89e30e4000407}{getWALABias}()->\hyperlink{classwala_acb8e59580d97bc3c5b9b4ff45eb6bb9a}{lnF}() << \textcolor{stringliteral}{" at "} << \hyperlink{utilities_8cpp_aa6d910bf51f18a75deb20c6f0fbba285}{getTimeStamp}() << std::endl;
67         \}
68     \}
69 
70     \textcolor{comment}{// Switch over to TMMC completely}
71     std::cout << \textcolor{stringliteral}{"Switching over to TMMC completely, ending Wang-Landau"} << std::endl;
72     sys.\hyperlink{classsim_system_ad6febde00f19ae0787771f2d1d9e391b}{stopWALA}();
73     \textcolor{keywordflow}{try} \{
74         sys.\hyperlink{classsim_system_aa31d40c91cb50f143a9613d362798887}{getTMMCBias}()->\hyperlink{classtmmc_a8e065523e9cc3c9628f91d3804cd201e}{calculatePI}();
75         \textcolor{comment}{//sys.getTMMCBias()->print("tmmc-beginning-Checkpoint", true);}
76     \} \textcolor{keywordflow}{catch} (\hyperlink{classcustom_exception}{customException} &ce) \{
77         std::cerr << ce.\hyperlink{classcustom_exception_aeb6ab5848b038adfc68fde86a512f691}{what}() << std::endl;
78         sys.\hyperlink{classsim_system_aa31d40c91cb50f143a9613d362798887}{getTMMCBias}()->\hyperlink{classtmmc_ad49e147dc88b3e1c2975269598f94327}{print}(\textcolor{stringliteral}{"tmmc-beginning-fail"}, \textcolor{keyword}{true});
79         sys.\hyperlink{classsim_system_aa31d40c91cb50f143a9613d362798887}{getTMMCBias}()->\hyperlink{classtmmc_a295886d2f7a947a9de890bcb3adb51c7}{dumpVisited}(\textcolor{stringliteral}{"tmmc-beginning-fail-visited"});
80         exit(\hyperlink{global_8h_a428dfe1ef0a6ff4b1fdebf275f6aff2e}{SYS\_FAILURE});
81     \}
82 
83     \textcolor{comment}{// if doing initial WL "equilibration" re-initialize the histogram using bounds}
84     sys.\hyperlink{classsim_system_a861dd81718ef1c069fa7cfb9b7efe83c}{reInitializeEnergyHistogram}();
85 
86     \hyperlink{sanity_8cpp_a73138cec3a48e4523004092dc0c2954b}{sanityChecks}(sys);
87     res.\hyperlink{classcheckpoint_a4f13612ea6d376bb327295bfce3a70c5}{crossoverDone} = \textcolor{keyword}{true};
88 \}
\end{DoxyCode}
