\hypertarget{classswap_particles}{\section{swap\-Particles Class Reference}
\label{classswap_particles}\index{swap\-Particles@{swap\-Particles}}
}


{\ttfamily \#include $<$swap.\-h$>$}

Inheritance diagram for swap\-Particles\-:\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[height=2.000000cm]{classswap_particles}
\end{center}
\end{figure}
\subsection*{Public Member Functions}
\begin{DoxyCompactItemize}
\item 
\hyperlink{classswap_particles_a1c476913d5b129db6daf5a1a1a5dd209}{swap\-Particles} ()
\item 
\hyperlink{classswap_particles_aac7a7fb48c4ffd3809221fac7a7800a5}{swap\-Particles} (const int type\-Index1, const int type\-Index2, const std\-::string tag)
\begin{DoxyCompactList}\small\item\em Instantiate a new move, also give a name which is the combination of a user-\/defined tag + the particle indices it operates on. \end{DoxyCompactList}\item 
int \hyperlink{classswap_particles_ad8ca574f8e5308b6f0a5f3c7c2799209}{make} (\hyperlink{classsim_system}{sim\-System} \&sys)
\begin{DoxyCompactList}\small\item\em Swap two particles of different types in the system. \end{DoxyCompactList}\end{DoxyCompactItemize}
\subsection*{Additional Inherited Members}


\subsection{Detailed Description}


Definition at line 14 of file swap.\-h.



\subsection{Constructor \& Destructor Documentation}
\hypertarget{classswap_particles_a1c476913d5b129db6daf5a1a1a5dd209}{\index{swap\-Particles@{swap\-Particles}!swap\-Particles@{swap\-Particles}}
\index{swap\-Particles@{swap\-Particles}!swapParticles@{swap\-Particles}}
\subsubsection[{swap\-Particles}]{\setlength{\rightskip}{0pt plus 5cm}swap\-Particles\-::swap\-Particles (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [inline]}}}\label{classswap_particles_a1c476913d5b129db6daf5a1a1a5dd209}


Definition at line 16 of file swap.\-h.



References mc\-Move\-::change\-N\-\_\-.


\begin{DoxyCode}
16 \{ \hyperlink{classmc_move_add8d6d08be181274a61c7463159ad929}{changeN\_} = \textcolor{keyword}{false}; \}
\end{DoxyCode}
\hypertarget{classswap_particles_aac7a7fb48c4ffd3809221fac7a7800a5}{\index{swap\-Particles@{swap\-Particles}!swap\-Particles@{swap\-Particles}}
\index{swap\-Particles@{swap\-Particles}!swapParticles@{swap\-Particles}}
\subsubsection[{swap\-Particles}]{\setlength{\rightskip}{0pt plus 5cm}swap\-Particles\-::swap\-Particles (
\begin{DoxyParamCaption}
\item[{const int}]{type\-Index1, }
\item[{const int}]{type\-Index2, }
\item[{const std\-::string}]{tag}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [inline]}}}\label{classswap_particles_aac7a7fb48c4ffd3809221fac7a7800a5}


Instantiate a new move, also give a name which is the combination of a user-\/defined tag + the particle indices it operates on. 



Definition at line 17 of file swap.\-h.



References mc\-Move\-::change\-N\-\_\-, mc\-Move\-::name\-\_\-, and mc\-Move\-::type\-Index\-\_\-.



\subsection{Member Function Documentation}
\hypertarget{classswap_particles_ad8ca574f8e5308b6f0a5f3c7c2799209}{\index{swap\-Particles@{swap\-Particles}!make@{make}}
\index{make@{make}!swapParticles@{swap\-Particles}}
\subsubsection[{make}]{\setlength{\rightskip}{0pt plus 5cm}int swap\-Particles\-::make (
\begin{DoxyParamCaption}
\item[{{\bf sim\-System} \&}]{sys}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [virtual]}}}\label{classswap_particles_ad8ca574f8e5308b6f0a5f3c7c2799209}


Swap two particles of different types in the system. 

All other information is stored in the \hyperlink{classsim_system}{sim\-System} object.


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em sys} & System object to attempt to swap particles in.\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
M\-O\-V\-E\-\_\-\-S\-U\-C\-C\-E\-S\-S if particles are swapped, otherwise M\-O\-V\-E\-\_\-\-F\-A\-I\-L\-U\-R\-E if not. Will throw exceptions if there was an error. 
\end{DoxyReturn}


Implements \hyperlink{classmc_move_a2e377a628f9ecee5422fc8967d4924eb}{mc\-Move}.



Definition at line 10 of file swap.\-cpp.



References sim\-System\-::atoms, sim\-System\-::beta(), sim\-System\-::box(), calculate\-Bias(), sim\-System\-::delete\-Atom(), sim\-System\-::get\-Current\-M(), sim\-System\-::get\-Fractional\-Atom(), sim\-System\-::get\-Fractional\-Atom\-Type(), sim\-System\-::get\-Neighbor\-Atoms(), sim\-System\-::get\-Tot\-N(), sim\-System\-::get\-W\-A\-L\-A\-Bias(), sim\-System\-::increment\-Energy(), sim\-System\-::insert\-Atom(), M\-O\-V\-E\-\_\-\-F\-A\-I\-L\-U\-R\-E, M\-O\-V\-E\-\_\-\-S\-U\-C\-C\-E\-S\-S, sim\-System\-::n\-Species(), sim\-System\-::num\-Species, atom\-::pos, sim\-System\-::ppot, rng(), R\-N\-G\-\_\-\-S\-E\-E\-D, sim\-System\-::species\-Barriers, sim\-System\-::tmmc\-Bias, mc\-Move\-::type\-Index\-\_\-, wala\-::update(), tmmc\-::update\-C(), sim\-System\-::use\-T\-M\-M\-C, sim\-System\-::use\-W\-A\-L\-A, and custom\-Exception\-::what().


\begin{DoxyCode}
10                                        \{
11     \textcolor{comment}{// Choose an atom of each type to try to exchange}
12     \textcolor{keywordtype}{int} n1Avail = sys.\hyperlink{classsim_system_a9eea865e6dc1cff377b1e79c4d9c23f0}{numSpecies}[\hyperlink{classmc_move_acb731965547b0326ef318ec96da8b46a}{typeIndex\_}];
13     \textcolor{keywordflow}{if} (sys.\hyperlink{classsim_system_a299fe4372e610b554eaaf5f5957b2dbc}{getCurrentM}() > 0 && sys.\hyperlink{classsim_system_a0500a9e84eecfbde7a98cf8a34f719d5}{getFractionalAtomType}() == 
      \hyperlink{classmc_move_acb731965547b0326ef318ec96da8b46a}{typeIndex\_}) \{
14         n1Avail++;
15     \}
16 
17     \textcolor{keywordtype}{int} n2Avail = sys.\hyperlink{classsim_system_a9eea865e6dc1cff377b1e79c4d9c23f0}{numSpecies}[typeIndex2\_];
18     \textcolor{keywordflow}{if} (sys.\hyperlink{classsim_system_a299fe4372e610b554eaaf5f5957b2dbc}{getCurrentM}() > 0 && sys.\hyperlink{classsim_system_a0500a9e84eecfbde7a98cf8a34f719d5}{getFractionalAtomType}() == typeIndex2\_
      ) \{
19         n2Avail++;
20     \}
21 
22     \textcolor{keywordflow}{if} (n1Avail < 1 || n2Avail < 1) \{
23         \textcolor{comment}{// updates to biasing functions must be done even if at bounds}
24         \textcolor{keywordflow}{if} (sys.\hyperlink{classsim_system_aa83b00006b3919fb6e13f1bdeadece6a}{useWALA}) \{
25             sys.\hyperlink{classsim_system_a7cb5049de8b0988349e89e30e4000407}{getWALABias}()->\hyperlink{classwala_ab439e3f60bea6c54522a870b9ad67acf}{update}(sys.\hyperlink{classsim_system_a37dd827f4057049763351510147b9f1d}{getTotN}(), sys.
      \hyperlink{classsim_system_a299fe4372e610b554eaaf5f5957b2dbc}{getCurrentM}());
26         \}
27         \textcolor{keywordflow}{if} (sys.\hyperlink{classsim_system_aa474a50b6353c8897331b1ab1ce53ab1}{useTMMC}) \{
28             sys.\hyperlink{classsim_system_a13173f45a1e40a5f5a3552b0ebe15b54}{tmmcBias}->\hyperlink{classtmmc_ae067afc5b52af203b9d45f18d9737219}{updateC} (sys.\hyperlink{classsim_system_a37dd827f4057049763351510147b9f1d}{getTotN}(), sys.
      \hyperlink{classsim_system_a37dd827f4057049763351510147b9f1d}{getTotN}(), sys.\hyperlink{classsim_system_a299fe4372e610b554eaaf5f5957b2dbc}{getCurrentM}(), sys.\hyperlink{classsim_system_a299fe4372e610b554eaaf5f5957b2dbc}{getCurrentM}(), 0.0);
29         \}
30         \textcolor{keywordflow}{return} \hyperlink{moves_8h_a9832cf5fcfa8c0894545b591c9908e39}{MOVE\_FAILURE};
31     \}
32 
33     \textcolor{comment}{// because the locations are effectively being swapped, it is fair to select a partially inserted atom
       to be involved}
34     \textcolor{keyword}{const} \textcolor{keywordtype}{int} a1 = (int) floor(\hyperlink{utilities_8cpp_a0f9542af4b475ac79cb679d7a8d14db0}{rng} (&\hyperlink{global_8h_a3f4e4ea24d5a5c66feae55d1f329c884}{RNG\_SEED}) * n1Avail);
35     \textcolor{keyword}{const} \textcolor{keywordtype}{int} a2 = (int) floor(\hyperlink{utilities_8cpp_a0f9542af4b475ac79cb679d7a8d14db0}{rng} (&\hyperlink{global_8h_a3f4e4ea24d5a5c66feae55d1f329c884}{RNG\_SEED}) * n2Avail);
36     \hyperlink{classatom}{atom} a1\_orig = sys.\hyperlink{classsim_system_a90421b19082f7fb8fc23b7264b1161e4}{atoms}[\hyperlink{classmc_move_acb731965547b0326ef318ec96da8b46a}{typeIndex\_}][a1], a1\_new = a1\_orig;
37     \hyperlink{classatom}{atom} a2\_orig = sys.\hyperlink{classsim_system_a90421b19082f7fb8fc23b7264b1161e4}{atoms}[typeIndex2\_][a2], a2\_new = a2\_orig;
38 
39     \textcolor{comment}{// positions will be exchanged, but no other property should change}
40     a1\_new.\hyperlink{classatom_a3ae5f4880e7831d8b2c9fda72b4eb24a}{pos} = a2\_orig.\hyperlink{classatom_a3ae5f4880e7831d8b2c9fda72b4eb24a}{pos};
41     a2\_new.pos = a1\_orig.\hyperlink{classatom_a3ae5f4880e7831d8b2c9fda72b4eb24a}{pos};
42 
43     \textcolor{keyword}{const} std::vector < double > box = sys.\hyperlink{classsim_system_a8bff9dfb95b1b09a0fab2c1c485ade07}{box}();
44     \textcolor{keywordtype}{double} V = 1.0;
45     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} i = 0; i < box.size(); ++i) \{
46             V *= box[i];
47         \}
48 
49         \textcolor{keywordtype}{double} delEnergy = 0.0;
50         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} spec = 0; spec < sys.\hyperlink{classsim_system_ab5e2e9b6204de15520302fe1d51688dd}{nSpecies}(); ++spec) \{
51             \textcolor{comment}{// get positions of neighboring atoms around a1}
52             std::vector < atom* > neighborAtoms = sys.\hyperlink{classsim_system_a9b3aeefa22c3b50b5913df6eea753bc6}{getNeighborAtoms}(spec, 
      \hyperlink{classmc_move_acb731965547b0326ef318ec96da8b46a}{typeIndex\_}, &sys.\hyperlink{classsim_system_a90421b19082f7fb8fc23b7264b1161e4}{atoms}[\hyperlink{classmc_move_acb731965547b0326ef318ec96da8b46a}{typeIndex\_}][a1]);
53             \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} i = 0; i < neighborAtoms.size(); ++i) \{
54                 \textcolor{keywordflow}{if} (neighborAtoms[i] == &sys.\hyperlink{classsim_system_a90421b19082f7fb8fc23b7264b1161e4}{atoms}[typeIndex2\_][a2]) \{
55                     \textcolor{comment}{// skip their interaction as they were already deleted - this is fine because their net
       pairwise interaction doesn't change over the}
56                     \textcolor{comment}{// course of the simulation - this means we don't have to actually re-insert the other
       atom / get its interation somehow later}
57                     \textcolor{keywordflow}{continue};
58                 \} \textcolor{keywordflow}{else} \{
59                 \textcolor{keywordflow}{try} \{
60                     delEnergy += sys.\hyperlink{classsim_system_ad2e290b5963f132e6a3a56cee35c8e9f}{ppot}[spec][\hyperlink{classmc_move_acb731965547b0326ef318ec96da8b46a}{typeIndex\_}]->energy(neighborAtoms[i], &sys.
      \hyperlink{classsim_system_a90421b19082f7fb8fc23b7264b1161e4}{atoms}[\hyperlink{classmc_move_acb731965547b0326ef318ec96da8b46a}{typeIndex\_}][a1], box);
61                 \} \textcolor{keywordflow}{catch} (\hyperlink{classcustom_exception}{customException}& ce) \{
62                     std::string a = \textcolor{stringliteral}{"Cannot delete because of energy error: "}, b = ce.
      \hyperlink{classcustom_exception_aeb6ab5848b038adfc68fde86a512f691}{what}();
63                     \textcolor{keywordflow}{throw} \hyperlink{classcustom_exception}{customException} (a+b);
64                 \}
65                 \}
66             \}
67             \textcolor{comment}{// add tail correction to potential energy -- only enable for fluid phase simulations}
68 \textcolor{preprocessor}{#ifdef FLUID\_PHASE\_SIMULATIONS}
69 \textcolor{preprocessor}{}            \textcolor{keywordflow}{if} (sys.\hyperlink{classsim_system_ad2e290b5963f132e6a3a56cee35c8e9f}{ppot}[spec][\hyperlink{classmc_move_acb731965547b0326ef318ec96da8b46a}{typeIndex\_}]->useTailCorrection) \{
70                 \textcolor{keywordflow}{if} (!(sys.\hyperlink{classsim_system_a299fe4372e610b554eaaf5f5957b2dbc}{getCurrentM}() > 0 && sys.\hyperlink{classsim_system_a2ab77377c60e0e3109a6e875690b0ab7}{getFractionalAtom} () == &sys
      .\hyperlink{classsim_system_a90421b19082f7fb8fc23b7264b1161e4}{atoms}[\hyperlink{classmc_move_acb731965547b0326ef318ec96da8b46a}{typeIndex\_}][a1])) \{
71                     \textcolor{comment}{// then a1 is not the partially inserted particle and tail interactions must be
       included}
72                     \textcolor{keywordflow}{if} (spec == typeIndex\_) \{
73                                 \textcolor{keywordflow}{if} (sys.\hyperlink{classsim_system_a9eea865e6dc1cff377b1e79c4d9c23f0}{numSpecies}[spec]-1 > 0) \{
74                                     delEnergy += sys.\hyperlink{classsim_system_ad2e290b5963f132e6a3a56cee35c8e9f}{ppot}[spec][\hyperlink{classmc_move_acb731965547b0326ef318ec96da8b46a}{typeIndex\_}]->tailCorrection((
      sys.\hyperlink{classsim_system_a9eea865e6dc1cff377b1e79c4d9c23f0}{numSpecies}[spec]-1)/V);
75                                 \}
76                     \} \textcolor{keywordflow}{else} \{
77                                 \textcolor{keywordflow}{if} (sys.\hyperlink{classsim_system_a9eea865e6dc1cff377b1e79c4d9c23f0}{numSpecies}[spec] > 0) \{
78                                     delEnergy += sys.\hyperlink{classsim_system_ad2e290b5963f132e6a3a56cee35c8e9f}{ppot}[spec][\hyperlink{classmc_move_acb731965547b0326ef318ec96da8b46a}{typeIndex\_}]->tailCorrection(
      sys.\hyperlink{classsim_system_a9eea865e6dc1cff377b1e79c4d9c23f0}{numSpecies}[spec]/V);
79                                 \}
80                     \}
81                 \}
82             \}
83 \textcolor{preprocessor}{#endif}
84 \textcolor{preprocessor}{}    \}
85 
86     \textcolor{comment}{// account for wall interaction energy}
87     delEnergy += sys.\hyperlink{classsim_system_a5ae652ff4519f39c3862abae32a9581b}{speciesBarriers}[\hyperlink{classmc_move_acb731965547b0326ef318ec96da8b46a}{typeIndex\_}].energy(&sys.
      \hyperlink{classsim_system_a90421b19082f7fb8fc23b7264b1161e4}{atoms}[typeIndex\_][a1], box);
88 
89         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} spec = 0; spec < sys.\hyperlink{classsim_system_ab5e2e9b6204de15520302fe1d51688dd}{nSpecies}(); ++spec) \{
90             \textcolor{comment}{// get positions of neighboring atoms around a2}
91             std::vector < atom* > neighborAtoms = sys.\hyperlink{classsim_system_a9b3aeefa22c3b50b5913df6eea753bc6}{getNeighborAtoms}(spec, typeIndex2\_, &
      sys.\hyperlink{classsim_system_a90421b19082f7fb8fc23b7264b1161e4}{atoms}[typeIndex2\_][a2]);
92             \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} i = 0; i < neighborAtoms.size(); ++i) \{
93                 \textcolor{keywordflow}{if} (neighborAtoms[i] == &sys.\hyperlink{classsim_system_a90421b19082f7fb8fc23b7264b1161e4}{atoms}[typeIndex\_][a1]) \{
94                     \textcolor{comment}{// skip their interaction as they were already deleted - this is fine because their net
       pairwise interaction doesn't change over the}
95                     \textcolor{comment}{// course of the simulation - this means we don't have to actually re-insert the other
       atom / get its interation somehow later}
96                     \textcolor{keywordflow}{continue};
97                 \} \textcolor{keywordflow}{else} \{
98                 \textcolor{keywordflow}{try} \{
99                     delEnergy += sys.\hyperlink{classsim_system_ad2e290b5963f132e6a3a56cee35c8e9f}{ppot}[spec][typeIndex2\_]->energy(neighborAtoms[i], &sys.
      \hyperlink{classsim_system_a90421b19082f7fb8fc23b7264b1161e4}{atoms}[typeIndex2\_][a2], box);
100                 \} \textcolor{keywordflow}{catch} (\hyperlink{classcustom_exception}{customException}& ce) \{
101                     std::string a = \textcolor{stringliteral}{"Cannot delete because of energy error: "}, b = ce.
      \hyperlink{classcustom_exception_aeb6ab5848b038adfc68fde86a512f691}{what}();
102                     \textcolor{keywordflow}{throw} \hyperlink{classcustom_exception}{customException} (a+b);
103                 \}
104                 \}
105             \}
106             \textcolor{comment}{// add tail correction to potential energy -- only enable for fluid phase simulations}
107 \textcolor{preprocessor}{#ifdef FLUID\_PHASE\_SIMULATIONS}
108 \textcolor{preprocessor}{}            \textcolor{keywordflow}{if} (sys.\hyperlink{classsim_system_ad2e290b5963f132e6a3a56cee35c8e9f}{ppot}[spec][typeIndex2\_]->useTailCorrection) \{
109                 \textcolor{keywordflow}{if} (!(sys.\hyperlink{classsim_system_a299fe4372e610b554eaaf5f5957b2dbc}{getCurrentM}() > 0 && sys.\hyperlink{classsim_system_a2ab77377c60e0e3109a6e875690b0ab7}{getFractionalAtom} () == &sys
      .\hyperlink{classsim_system_a90421b19082f7fb8fc23b7264b1161e4}{atoms}[typeIndex2\_][a2])) \{
110                     \textcolor{comment}{// then a2 is not the partially inserted particle and tail interactions must be
       included}
111                     \textcolor{keywordflow}{if} (spec == typeIndex2\_) \{
112                                 \textcolor{keywordflow}{if} (sys.\hyperlink{classsim_system_a9eea865e6dc1cff377b1e79c4d9c23f0}{numSpecies}[spec]-1 > 0) \{
113                                     delEnergy += sys.\hyperlink{classsim_system_ad2e290b5963f132e6a3a56cee35c8e9f}{ppot}[spec][typeIndex2\_]->tailCorrection((sys.
      \hyperlink{classsim_system_a9eea865e6dc1cff377b1e79c4d9c23f0}{numSpecies}[spec]-1)/V);
114                                 \}
115                     \} \textcolor{keywordflow}{else} \{
116                                 \textcolor{keywordflow}{if} (sys.\hyperlink{classsim_system_a9eea865e6dc1cff377b1e79c4d9c23f0}{numSpecies}[spec] > 0) \{
117                                     delEnergy += sys.\hyperlink{classsim_system_ad2e290b5963f132e6a3a56cee35c8e9f}{ppot}[spec][typeIndex2\_]->tailCorrection(sys.
      \hyperlink{classsim_system_a9eea865e6dc1cff377b1e79c4d9c23f0}{numSpecies}[spec]/V);
118                                 \}
119                     \}
120                 \}
121             \}
122 \textcolor{preprocessor}{#endif}
123 \textcolor{preprocessor}{}        \}
124 
125         \textcolor{comment}{// account for wall interaction energy}
126         delEnergy += sys.\hyperlink{classsim_system_a5ae652ff4519f39c3862abae32a9581b}{speciesBarriers}[typeIndex2\_].energy(&sys.
      \hyperlink{classsim_system_a90421b19082f7fb8fc23b7264b1161e4}{atoms}[typeIndex2\_][a2], box);
127 
128         \textcolor{keywordtype}{double} insEnergy = 0.0;
129         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} spec = 0; spec < sys.\hyperlink{classsim_system_ab5e2e9b6204de15520302fe1d51688dd}{nSpecies}(); ++spec) \{
130             \textcolor{comment}{// get positions of neighboring atoms around a1's (a2's) new (old) location}
131             std::vector < atom* > neighborAtoms = sys.\hyperlink{classsim_system_a9b3aeefa22c3b50b5913df6eea753bc6}{getNeighborAtoms}(spec, typeIndex\_, &
      a1\_new);
132             \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} i = 0; i < neighborAtoms.size(); ++i) \{
133                 \textcolor{comment}{// with these new "copy atoms" getNeighborAtoms can't guarantee it doesn't point to old
       self, so must check}
134                 \textcolor{keywordflow}{if} ((neighborAtoms[i] == &sys.\hyperlink{classsim_system_a90421b19082f7fb8fc23b7264b1161e4}{atoms}[typeIndex2\_][a2]) || (neighborAtoms[i] == &sys.
      \hyperlink{classsim_system_a90421b19082f7fb8fc23b7264b1161e4}{atoms}[\hyperlink{classmc_move_acb731965547b0326ef318ec96da8b46a}{typeIndex\_}][a1])) \{
135                     \textcolor{keywordflow}{continue};
136                 \} \textcolor{keywordflow}{else} \{
137                 \textcolor{keywordflow}{try} \{
138                     insEnergy += sys.\hyperlink{classsim_system_ad2e290b5963f132e6a3a56cee35c8e9f}{ppot}[spec][\hyperlink{classmc_move_acb731965547b0326ef318ec96da8b46a}{typeIndex\_}]->energy(neighborAtoms[i], &a1\_new
      , box);
139                 \} \textcolor{keywordflow}{catch} (\hyperlink{classcustom_exception}{customException}& ce) \{
140                     std::string a = \textcolor{stringliteral}{"Cannot insert because of energy error: "}, b = ce.
      \hyperlink{classcustom_exception_aeb6ab5848b038adfc68fde86a512f691}{what}();
141                     \textcolor{keywordflow}{throw} \hyperlink{classcustom_exception}{customException} (a+b);
142                 \}
143                 \}
144             \}
145             \textcolor{comment}{// add tail correction to potential energy -- only enable for fluid phase simulations}
146 \textcolor{preprocessor}{#ifdef FLUID\_PHASE\_SIMULATIONS}
147 \textcolor{preprocessor}{}            \textcolor{keywordflow}{if} (sys.\hyperlink{classsim_system_ad2e290b5963f132e6a3a56cee35c8e9f}{ppot}[spec][typeIndex\_]->useTailCorrection) \{
148                 \textcolor{keywordflow}{if} (!(sys.\hyperlink{classsim_system_a299fe4372e610b554eaaf5f5957b2dbc}{getCurrentM}() > 0 && sys.\hyperlink{classsim_system_a2ab77377c60e0e3109a6e875690b0ab7}{getFractionalAtom} () == &sys
      .\hyperlink{classsim_system_a90421b19082f7fb8fc23b7264b1161e4}{atoms}[\hyperlink{classmc_move_acb731965547b0326ef318ec96da8b46a}{typeIndex\_}][a1])) \{
149                     \textcolor{comment}{// then a1 is not the partially inserted particle and tail interactions must be
       included}
150                     \textcolor{keywordflow}{if} (spec == typeIndex\_) \{
151                                 \textcolor{keywordflow}{if} (sys.\hyperlink{classsim_system_a9eea865e6dc1cff377b1e79c4d9c23f0}{numSpecies}[spec]-1 > 0) \{
152                                     insEnergy += sys.\hyperlink{classsim_system_ad2e290b5963f132e6a3a56cee35c8e9f}{ppot}[spec][\hyperlink{classmc_move_acb731965547b0326ef318ec96da8b46a}{typeIndex\_}]->tailCorrection((
      sys.\hyperlink{classsim_system_a9eea865e6dc1cff377b1e79c4d9c23f0}{numSpecies}[spec]-1)/V);
153                             \}
154                     \} \textcolor{keywordflow}{else} \{
155                                 \textcolor{keywordflow}{if} (sys.\hyperlink{classsim_system_a9eea865e6dc1cff377b1e79c4d9c23f0}{numSpecies}[spec] > 0) \{
156                                     insEnergy += sys.\hyperlink{classsim_system_ad2e290b5963f132e6a3a56cee35c8e9f}{ppot}[spec][\hyperlink{classmc_move_acb731965547b0326ef318ec96da8b46a}{typeIndex\_}]->tailCorrection(
      sys.\hyperlink{classsim_system_a9eea865e6dc1cff377b1e79c4d9c23f0}{numSpecies}[spec]/V);
157                                 \}
158                     \}
159                 \}
160             \}
161 \textcolor{preprocessor}{#endif}
162 \textcolor{preprocessor}{}        \}
163         \textcolor{comment}{// account for wall interaction energy}
164         insEnergy += sys.\hyperlink{classsim_system_a5ae652ff4519f39c3862abae32a9581b}{speciesBarriers}[\hyperlink{classmc_move_acb731965547b0326ef318ec96da8b46a}{typeIndex\_}].energy(&a1\_new, box);
165 
166         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} spec = 0; spec < sys.\hyperlink{classsim_system_ab5e2e9b6204de15520302fe1d51688dd}{nSpecies}(); ++spec) \{
167             \textcolor{comment}{// get positions of neighboring atoms around a2's (a1's) new (old) location}
168             std::vector < atom* > neighborAtoms = sys.\hyperlink{classsim_system_a9b3aeefa22c3b50b5913df6eea753bc6}{getNeighborAtoms}(spec, typeIndex2\_, &
      a2\_new);
169             \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} i = 0; i < neighborAtoms.size(); ++i) \{
170                 \textcolor{keywordflow}{if} ((neighborAtoms[i] == &sys.\hyperlink{classsim_system_a90421b19082f7fb8fc23b7264b1161e4}{atoms}[typeIndex\_][a1]) || (neighborAtoms[i] == &sys.
      \hyperlink{classsim_system_a90421b19082f7fb8fc23b7264b1161e4}{atoms}[typeIndex2\_][a2])) \{
171                     \textcolor{keywordflow}{continue};
172                 \} \textcolor{keywordflow}{else} \{
173                 \textcolor{keywordflow}{try} \{
174                     insEnergy += sys.\hyperlink{classsim_system_ad2e290b5963f132e6a3a56cee35c8e9f}{ppot}[spec][typeIndex2\_]->energy(neighborAtoms[i], &a2\_new, box);
175                 \} \textcolor{keywordflow}{catch} (\hyperlink{classcustom_exception}{customException}& ce) \{
176                     std::string a = \textcolor{stringliteral}{"Cannot insert because of energy error: "}, b = ce.
      \hyperlink{classcustom_exception_aeb6ab5848b038adfc68fde86a512f691}{what}();
177                     \textcolor{keywordflow}{throw} \hyperlink{classcustom_exception}{customException} (a+b);
178                 \}
179                 \}
180             \}
181             \textcolor{comment}{// add tail correction to potential energy -- only enable for fluid phase simulations}
182 \textcolor{preprocessor}{#ifdef FLUID\_PHASE\_SIMULATIONS}
183 \textcolor{preprocessor}{}            \textcolor{keywordflow}{if} (sys.\hyperlink{classsim_system_ad2e290b5963f132e6a3a56cee35c8e9f}{ppot}[spec][typeIndex2\_]->useTailCorrection) \{
184                 \textcolor{keywordflow}{if} (!(sys.\hyperlink{classsim_system_a299fe4372e610b554eaaf5f5957b2dbc}{getCurrentM}() > 0 && sys.\hyperlink{classsim_system_a2ab77377c60e0e3109a6e875690b0ab7}{getFractionalAtom} () == &sys
      .\hyperlink{classsim_system_a90421b19082f7fb8fc23b7264b1161e4}{atoms}[typeIndex2\_][a2])) \{
185                     \textcolor{comment}{// then a2 is not the partially inserted particle and tail interactions must be
       included}
186                     \textcolor{keywordflow}{if} (spec == typeIndex2\_) \{
187                                 \textcolor{keywordflow}{if} (sys.\hyperlink{classsim_system_a9eea865e6dc1cff377b1e79c4d9c23f0}{numSpecies}[spec]-1 > 0) \{
188                                     insEnergy += sys.\hyperlink{classsim_system_ad2e290b5963f132e6a3a56cee35c8e9f}{ppot}[spec][typeIndex2\_]->tailCorrection((sys.
      \hyperlink{classsim_system_a9eea865e6dc1cff377b1e79c4d9c23f0}{numSpecies}[spec]-1)/V);
189                                 \}
190                     \} \textcolor{keywordflow}{else} \{
191                                 \textcolor{keywordflow}{if} (sys.\hyperlink{classsim_system_a9eea865e6dc1cff377b1e79c4d9c23f0}{numSpecies}[spec] > 0) \{
192                                     insEnergy += sys.\hyperlink{classsim_system_ad2e290b5963f132e6a3a56cee35c8e9f}{ppot}[spec][typeIndex2\_]->tailCorrection(sys.
      \hyperlink{classsim_system_a9eea865e6dc1cff377b1e79c4d9c23f0}{numSpecies}[spec]/V);
193                                 \}
194                     \}
195                 \}
196             \}
197 \textcolor{preprocessor}{#endif}
198 \textcolor{preprocessor}{}        \}
199         \textcolor{comment}{// account for wall interaction energy}
200         insEnergy += sys.\hyperlink{classsim_system_a5ae652ff4519f39c3862abae32a9581b}{speciesBarriers}[typeIndex2\_].energy(&a2\_new, box);
201 
202     \textcolor{comment}{// Biasing}
203         \textcolor{keyword}{const} \textcolor{keywordtype}{double} p\_u = exp(-sys.\hyperlink{classsim_system_a3eeec9678902f8d7fce4dad6064aaf4c}{beta}()*(insEnergy - delEnergy));
204         \textcolor{keywordtype}{double} bias = \hyperlink{system_8cpp_acfe185adf03db047fd3753c0d788e0e3}{calculateBias}(sys, sys.\hyperlink{classsim_system_a37dd827f4057049763351510147b9f1d}{getTotN}(), sys.
      \hyperlink{classsim_system_a299fe4372e610b554eaaf5f5957b2dbc}{getCurrentM}());
205 
206         \textcolor{comment}{// tmmc gets updated the same way, regardless of whether the move gets accepted}
207         \textcolor{keywordflow}{if} (sys.\hyperlink{classsim_system_aa474a50b6353c8897331b1ab1ce53ab1}{useTMMC}) \{
208             sys.\hyperlink{classsim_system_a13173f45a1e40a5f5a3552b0ebe15b54}{tmmcBias}->\hyperlink{classtmmc_ae067afc5b52af203b9d45f18d9737219}{updateC} (sys.\hyperlink{classsim_system_a37dd827f4057049763351510147b9f1d}{getTotN}(), sys.
      \hyperlink{classsim_system_a37dd827f4057049763351510147b9f1d}{getTotN}(), sys.\hyperlink{classsim_system_a299fe4372e610b554eaaf5f5957b2dbc}{getCurrentM}(), sys.\hyperlink{classsim_system_a299fe4372e610b554eaaf5f5957b2dbc}{getCurrentM}(), std::min(1.0, p\_u));
209         \}
210 
211     \textcolor{keywordflow}{if} (\hyperlink{utilities_8cpp_a0f9542af4b475ac79cb679d7a8d14db0}{rng} (&\hyperlink{global_8h_a3f4e4ea24d5a5c66feae55d1f329c884}{RNG\_SEED}) < p\_u*bias) \{
212         sys.\hyperlink{classsim_system_a6ad31c08955b80873f865b3069618dcb}{incrementEnergy}(insEnergy - delEnergy);
213 
214         \textcolor{comment}{// swap the particles by deleting/reinserting}
215 
216         \textcolor{comment}{// could probably make this faster by using translateAtom instead of full insert/delete?}
217 
218         \textcolor{comment}{// -a1 completely}
219         \textcolor{keywordflow}{try} \{
220             sys.\hyperlink{classsim_system_acabf4fc5b5b90bba62e1449ddb3646c6}{deleteAtom}(typeIndex\_, a1, \textcolor{keyword}{true});
221         \} \textcolor{keywordflow}{catch} (\hyperlink{classcustom_exception}{customException} &ce) \{
222             std::string a = \textcolor{stringliteral}{"Failed to delete atom during swapping: "}, b = ce.
      \hyperlink{classcustom_exception_aeb6ab5848b038adfc68fde86a512f691}{what}();
223             \textcolor{keywordflow}{throw} \hyperlink{classcustom_exception}{customException} (a+b);
224         \}
225 
226         \textcolor{comment}{// -a2 completely}
227         \textcolor{keywordflow}{try} \{
228             sys.\hyperlink{classsim_system_acabf4fc5b5b90bba62e1449ddb3646c6}{deleteAtom}(typeIndex2\_, a2, \textcolor{keyword}{true});
229         \} \textcolor{keywordflow}{catch} (\hyperlink{classcustom_exception}{customException} &ce) \{
230             std::string a = \textcolor{stringliteral}{"Failed to delete atom during swapping: "}, b = ce.
      \hyperlink{classcustom_exception_aeb6ab5848b038adfc68fde86a512f691}{what}();
231             \textcolor{keywordflow}{throw} \hyperlink{classcustom_exception}{customException} (a+b);
232         \}
233 
234         \textcolor{comment}{// +a1\_new completely}
235         \textcolor{keywordflow}{try} \{
236             sys.\hyperlink{classsim_system_a0404e9435cc046d19b6bb990678ee069}{insertAtom}(typeIndex\_, &a1\_new, \textcolor{keyword}{true});
237         \} \textcolor{keywordflow}{catch} (\hyperlink{classcustom_exception}{customException} &ce) \{
238             std::string a = \textcolor{stringliteral}{"Failed to insert atom during swapping: "}, b = ce.
      \hyperlink{classcustom_exception_aeb6ab5848b038adfc68fde86a512f691}{what}();
239             \textcolor{keywordflow}{throw} \hyperlink{classcustom_exception}{customException} (a+b);
240         \}
241 
242         \textcolor{comment}{// +a2\_new completely}
243         \textcolor{keywordflow}{try} \{
244             sys.\hyperlink{classsim_system_a0404e9435cc046d19b6bb990678ee069}{insertAtom}(typeIndex2\_, &a2\_new, \textcolor{keyword}{true});
245         \} \textcolor{keywordflow}{catch} (\hyperlink{classcustom_exception}{customException} &ce) \{
246             std::string a = \textcolor{stringliteral}{"Failed to insert atom during swapping: "}, b = ce.
      \hyperlink{classcustom_exception_aeb6ab5848b038adfc68fde86a512f691}{what}();
247             \textcolor{keywordflow}{throw} \hyperlink{classcustom_exception}{customException} (a+b);
248         \}
249 
250         \textcolor{comment}{// update Wang-Landau bias, if used}
251         \textcolor{keywordflow}{if} (sys.\hyperlink{classsim_system_aa83b00006b3919fb6e13f1bdeadece6a}{useWALA}) \{
252             sys.\hyperlink{classsim_system_a7cb5049de8b0988349e89e30e4000407}{getWALABias}()->\hyperlink{classwala_ab439e3f60bea6c54522a870b9ad67acf}{update}(sys.\hyperlink{classsim_system_a37dd827f4057049763351510147b9f1d}{getTotN}(), sys.
      \hyperlink{classsim_system_a299fe4372e610b554eaaf5f5957b2dbc}{getCurrentM}());
253         \}
254 
255         \textcolor{comment}{// double check}
256         \textcolor{comment}{/*if (n1\_orig != sys.numSpecies[typeIndex\_]) \{}
257 \textcolor{comment}{            throw customException ("Number of species 1 atoms do not match before and after swap move");}
258 \textcolor{comment}{        \}}
259 \textcolor{comment}{        if (n2\_orig != sys.numSpecies[typeIndex2\_]) \{}
260 \textcolor{comment}{            throw customException ("Number of species 2 atoms do not match before and after swap move");}
261 \textcolor{comment}{        \}}
262 \textcolor{comment}{        if (fracType != sys.getFractionalAtomType()) \{}
263 \textcolor{comment}{            throw customException ("Fractional type has changed during course of swap move");}
264 \textcolor{comment}{        \}}
265 \textcolor{comment}{        if (m\_orig != sys.getCurrentM()) \{}
266 \textcolor{comment}{            throw customException ("Expanded ensemble state of system has changed during course of swap
       move");}
267 \textcolor{comment}{        \}*/}
268 
269     \textcolor{keywordflow}{return} \hyperlink{moves_8h_ae8285cbddc5d21f73f49dcbad82a775a}{MOVE\_SUCCESS};
270         \}
271 
272     \textcolor{comment}{// update Wang-Landau bias (even if moved failed), if used}
273     \textcolor{keywordflow}{if} (sys.\hyperlink{classsim_system_aa83b00006b3919fb6e13f1bdeadece6a}{useWALA}) \{
274         sys.\hyperlink{classsim_system_a7cb5049de8b0988349e89e30e4000407}{getWALABias}()->\hyperlink{classwala_ab439e3f60bea6c54522a870b9ad67acf}{update}(sys.\hyperlink{classsim_system_a37dd827f4057049763351510147b9f1d}{getTotN}(), sys.
      \hyperlink{classsim_system_a299fe4372e610b554eaaf5f5957b2dbc}{getCurrentM}());
275     \}
276 
277     \textcolor{keywordflow}{return} \hyperlink{moves_8h_a9832cf5fcfa8c0894545b591c9908e39}{MOVE\_FAILURE};
278 \}
\end{DoxyCode}


The documentation for this class was generated from the following files\-:\begin{DoxyCompactItemize}
\item 
/home/nam4/\-Desktop/sandbox/\-F\-H\-M\-C\-Simulation/src/\hyperlink{swap_8h}{swap.\-h}\item 
/home/nam4/\-Desktop/sandbox/\-F\-H\-M\-C\-Simulation/src/\hyperlink{swap_8cpp}{swap.\-cpp}\end{DoxyCompactItemize}
