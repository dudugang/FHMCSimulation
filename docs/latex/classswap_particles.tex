\hypertarget{classswap_particles}{\section{swap\-Particles Class Reference}
\label{classswap_particles}\index{swap\-Particles@{swap\-Particles}}
}


{\ttfamily \#include $<$swap.\-h$>$}

Inheritance diagram for swap\-Particles\-:\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[height=2.000000cm]{classswap_particles}
\end{center}
\end{figure}
\subsection*{Public Member Functions}
\begin{DoxyCompactItemize}
\item 
\hyperlink{classswap_particles_a1c476913d5b129db6daf5a1a1a5dd209}{swap\-Particles} ()
\item 
\hyperlink{classswap_particles_aac7a7fb48c4ffd3809221fac7a7800a5}{swap\-Particles} (const int type\-Index1, const int type\-Index2, const std\-::string tag)
\begin{DoxyCompactList}\small\item\em Instantiate a new move, also give a name which is the combination of a user-\/defined tag + the particle indices it operates on. \end{DoxyCompactList}\item 
int \hyperlink{classswap_particles_ad8ca574f8e5308b6f0a5f3c7c2799209}{make} (\hyperlink{classsim_system}{sim\-System} \&sys)
\begin{DoxyCompactList}\small\item\em Swap two particles of different types in the system. \end{DoxyCompactList}\end{DoxyCompactItemize}
\subsection*{Additional Inherited Members}


\subsection{Detailed Description}


Definition at line 14 of file swap.\-h.



\subsection{Constructor \& Destructor Documentation}
\hypertarget{classswap_particles_a1c476913d5b129db6daf5a1a1a5dd209}{\index{swap\-Particles@{swap\-Particles}!swap\-Particles@{swap\-Particles}}
\index{swap\-Particles@{swap\-Particles}!swapParticles@{swap\-Particles}}
\subsubsection[{swap\-Particles}]{\setlength{\rightskip}{0pt plus 5cm}swap\-Particles\-::swap\-Particles (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [inline]}}}\label{classswap_particles_a1c476913d5b129db6daf5a1a1a5dd209}


Definition at line 16 of file swap.\-h.



References mc\-Move\-::change\-N\-\_\-.


\begin{DoxyCode}
16 \{ \hyperlink{classmc_move_add8d6d08be181274a61c7463159ad929}{changeN\_} = \textcolor{keyword}{false}; \}
\end{DoxyCode}
\hypertarget{classswap_particles_aac7a7fb48c4ffd3809221fac7a7800a5}{\index{swap\-Particles@{swap\-Particles}!swap\-Particles@{swap\-Particles}}
\index{swap\-Particles@{swap\-Particles}!swapParticles@{swap\-Particles}}
\subsubsection[{swap\-Particles}]{\setlength{\rightskip}{0pt plus 5cm}swap\-Particles\-::swap\-Particles (
\begin{DoxyParamCaption}
\item[{const int}]{type\-Index1, }
\item[{const int}]{type\-Index2, }
\item[{const std\-::string}]{tag}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [inline]}}}\label{classswap_particles_aac7a7fb48c4ffd3809221fac7a7800a5}


Instantiate a new move, also give a name which is the combination of a user-\/defined tag + the particle indices it operates on. 



Definition at line 17 of file swap.\-h.



References mc\-Move\-::change\-N\-\_\-, mc\-Move\-::name\-\_\-, and mc\-Move\-::type\-Index\-\_\-.



\subsection{Member Function Documentation}
\hypertarget{classswap_particles_ad8ca574f8e5308b6f0a5f3c7c2799209}{\index{swap\-Particles@{swap\-Particles}!make@{make}}
\index{make@{make}!swapParticles@{swap\-Particles}}
\subsubsection[{make}]{\setlength{\rightskip}{0pt plus 5cm}int swap\-Particles\-::make (
\begin{DoxyParamCaption}
\item[{{\bf sim\-System} \&}]{sys}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [virtual]}}}\label{classswap_particles_ad8ca574f8e5308b6f0a5f3c7c2799209}


Swap two particles of different types in the system. 

All other information is stored in the \hyperlink{classsim_system}{sim\-System} object.


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em sys} & System object to attempt to swap particles in.\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
M\-O\-V\-E\-\_\-\-S\-U\-C\-C\-E\-S\-S if particles are swapped, otherwise M\-O\-V\-E\-\_\-\-F\-A\-I\-L\-U\-R\-E if not. Will throw exceptions if there was an error. 
\end{DoxyReturn}


Implements \hyperlink{classmc_move_a2e377a628f9ecee5422fc8967d4924eb}{mc\-Move}.



Definition at line 10 of file swap.\-cpp.



References sim\-System\-::atoms, sim\-System\-::beta(), sim\-System\-::box(), calculate\-Bias(), sim\-System\-::delete\-Atom(), sim\-System\-::get\-Current\-M(), sim\-System\-::get\-Fractional\-Atom(), sim\-System\-::get\-Fractional\-Atom\-Type(), sim\-System\-::get\-Neighbor\-Atoms(), sim\-System\-::get\-Tot\-N(), sim\-System\-::get\-W\-A\-L\-A\-Bias(), sim\-System\-::increment\-Energy(), sim\-System\-::insert\-Atom(), M\-O\-V\-E\-\_\-\-F\-A\-I\-L\-U\-R\-E, M\-O\-V\-E\-\_\-\-S\-U\-C\-C\-E\-S\-S, sim\-System\-::n\-Species(), N\-U\-M\-\_\-\-I\-N\-F\-I\-N\-I\-T\-Y, sim\-System\-::num\-Species, atom\-::pos, sim\-System\-::ppot, rng(), R\-N\-G\-\_\-\-S\-E\-E\-D, sim\-System\-::species\-Barriers, sim\-System\-::tmmc\-Bias, mc\-Move\-::type\-Index\-\_\-, wala\-::update(), tmmc\-::update\-C(), sim\-System\-::use\-T\-M\-M\-C, sim\-System\-::use\-W\-A\-L\-A, and custom\-Exception\-::what().


\begin{DoxyCode}
10                                        \{
11     \textcolor{comment}{// Choose an atom of each type to try to exchange}
12     \textcolor{keywordtype}{int} n1Avail = sys.\hyperlink{classsim_system_a9eea865e6dc1cff377b1e79c4d9c23f0}{numSpecies}[\hyperlink{classmc_move_acb731965547b0326ef318ec96da8b46a}{typeIndex\_}];
13     \textcolor{keywordflow}{if} (sys.\hyperlink{classsim_system_a299fe4372e610b554eaaf5f5957b2dbc}{getCurrentM}() > 0 && sys.\hyperlink{classsim_system_a0500a9e84eecfbde7a98cf8a34f719d5}{getFractionalAtomType}() == 
      \hyperlink{classmc_move_acb731965547b0326ef318ec96da8b46a}{typeIndex\_}) \{
14         n1Avail++;
15     \}
16 
17     \textcolor{keywordtype}{int} n2Avail = sys.\hyperlink{classsim_system_a9eea865e6dc1cff377b1e79c4d9c23f0}{numSpecies}[typeIndex2\_];
18     \textcolor{keywordflow}{if} (sys.\hyperlink{classsim_system_a299fe4372e610b554eaaf5f5957b2dbc}{getCurrentM}() > 0 && sys.\hyperlink{classsim_system_a0500a9e84eecfbde7a98cf8a34f719d5}{getFractionalAtomType}() == typeIndex2\_
      ) \{
19         n2Avail++;
20     \}
21 
22     \textcolor{keywordflow}{if} (n1Avail < 1 || n2Avail < 1) \{
23         \textcolor{comment}{// Updates to biasing functions must be done even if at bounds}
24         \textcolor{keywordflow}{if} (sys.\hyperlink{classsim_system_aa83b00006b3919fb6e13f1bdeadece6a}{useWALA}) \{
25             sys.\hyperlink{classsim_system_a7cb5049de8b0988349e89e30e4000407}{getWALABias}()->\hyperlink{classwala_ab439e3f60bea6c54522a870b9ad67acf}{update}(sys.\hyperlink{classsim_system_a37dd827f4057049763351510147b9f1d}{getTotN}(), sys.
      \hyperlink{classsim_system_a299fe4372e610b554eaaf5f5957b2dbc}{getCurrentM}());
26         \}
27         \textcolor{keywordflow}{if} (sys.\hyperlink{classsim_system_aa474a50b6353c8897331b1ab1ce53ab1}{useTMMC}) \{
28             sys.\hyperlink{classsim_system_a13173f45a1e40a5f5a3552b0ebe15b54}{tmmcBias}->\hyperlink{classtmmc_ae067afc5b52af203b9d45f18d9737219}{updateC} (sys.\hyperlink{classsim_system_a37dd827f4057049763351510147b9f1d}{getTotN}(), sys.
      \hyperlink{classsim_system_a37dd827f4057049763351510147b9f1d}{getTotN}(), sys.\hyperlink{classsim_system_a299fe4372e610b554eaaf5f5957b2dbc}{getCurrentM}(), sys.\hyperlink{classsim_system_a299fe4372e610b554eaaf5f5957b2dbc}{getCurrentM}(), 0.0);
29         \}
30         \textcolor{keywordflow}{return} \hyperlink{moves_8h_a9832cf5fcfa8c0894545b591c9908e39}{MOVE\_FAILURE};
31     \}
32 
33     \textcolor{comment}{// Because the locations are effectively being swapped, it is fair to select a partially inserted atom
       to be involved}
34     \textcolor{keyword}{const} \textcolor{keywordtype}{int} a1 = (int) floor(\hyperlink{utilities_8cpp_a0f9542af4b475ac79cb679d7a8d14db0}{rng} (&\hyperlink{global_8h_a3f4e4ea24d5a5c66feae55d1f329c884}{RNG\_SEED}) * n1Avail);
35     \textcolor{keyword}{const} \textcolor{keywordtype}{int} a2 = (int) floor(\hyperlink{utilities_8cpp_a0f9542af4b475ac79cb679d7a8d14db0}{rng} (&\hyperlink{global_8h_a3f4e4ea24d5a5c66feae55d1f329c884}{RNG\_SEED}) * n2Avail);
36     \hyperlink{classatom}{atom} a1\_orig = sys.\hyperlink{classsim_system_a90421b19082f7fb8fc23b7264b1161e4}{atoms}[\hyperlink{classmc_move_acb731965547b0326ef318ec96da8b46a}{typeIndex\_}][a1], a1\_new = a1\_orig;
37     \hyperlink{classatom}{atom} a2\_orig = sys.\hyperlink{classsim_system_a90421b19082f7fb8fc23b7264b1161e4}{atoms}[typeIndex2\_][a2], a2\_new = a2\_orig;
38 
39     \textcolor{comment}{// Positions will be exchanged, but no other property should change}
40     a1\_new.\hyperlink{classatom_a3ae5f4880e7831d8b2c9fda72b4eb24a}{pos} = a2\_orig.\hyperlink{classatom_a3ae5f4880e7831d8b2c9fda72b4eb24a}{pos};
41     a2\_new.pos = a1\_orig.\hyperlink{classatom_a3ae5f4880e7831d8b2c9fda72b4eb24a}{pos};
42 
43     \textcolor{keyword}{const} std::vector < double > box = sys.\hyperlink{classsim_system_a8bff9dfb95b1b09a0fab2c1c485ade07}{box}();
44     \textcolor{keywordtype}{double} V = 1.0;
45     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} i = 0; i < box.size(); ++i) \{
46         V *= box[i];
47     \}
48 
49     \textcolor{keywordtype}{double} dU = 0.0;
50 
51     \textcolor{keywordtype}{double} delEnergy = 0.0;
52     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} spec = 0; spec < sys.\hyperlink{classsim_system_ab5e2e9b6204de15520302fe1d51688dd}{nSpecies}(); ++spec) \{
53         \textcolor{comment}{// Get positions of neighboring atoms around a1}
54         std::vector < atom* > neighborAtoms = sys.\hyperlink{classsim_system_a9b3aeefa22c3b50b5913df6eea753bc6}{getNeighborAtoms}(spec, 
      \hyperlink{classmc_move_acb731965547b0326ef318ec96da8b46a}{typeIndex\_}, &sys.\hyperlink{classsim_system_a90421b19082f7fb8fc23b7264b1161e4}{atoms}[\hyperlink{classmc_move_acb731965547b0326ef318ec96da8b46a}{typeIndex\_}][a1]);
55         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} i = 0; i < neighborAtoms.size(); ++i) \{
56             \textcolor{keywordflow}{if} (neighborAtoms[i] == &sys.\hyperlink{classsim_system_a90421b19082f7fb8fc23b7264b1161e4}{atoms}[typeIndex2\_][a2]) \{
57                 \textcolor{comment}{// Skip their interaction as they were already deleted - this is fine because their net
       pairwise interaction doesn't change over the course of the simulation - this means we don't have to actually
       re-insert the other atom / get its interation somehow later}
58                 \textcolor{keywordflow}{continue};
59             \} \textcolor{keywordflow}{else} \{
60                 \textcolor{keywordflow}{try} \{
61                     delEnergy += sys.\hyperlink{classsim_system_ad2e290b5963f132e6a3a56cee35c8e9f}{ppot}[spec][\hyperlink{classmc_move_acb731965547b0326ef318ec96da8b46a}{typeIndex\_}]->energy(neighborAtoms[i], &sys.
      \hyperlink{classsim_system_a90421b19082f7fb8fc23b7264b1161e4}{atoms}[\hyperlink{classmc_move_acb731965547b0326ef318ec96da8b46a}{typeIndex\_}][a1], box);
62                 \} \textcolor{keywordflow}{catch} (\hyperlink{classcustom_exception}{customException}& ce) \{
63                     std::string a = \textcolor{stringliteral}{"Cannot delete because of energy error: "}, b = ce.
      \hyperlink{classcustom_exception_aeb6ab5848b038adfc68fde86a512f691}{what}();
64                     \textcolor{keywordflow}{throw} \hyperlink{classcustom_exception}{customException} (a+b);
65                 \}
66             \}
67         \}
68         \textcolor{comment}{// Add tail correction to potential energy -- only enable for fluid phase simulations}
69 \textcolor{preprocessor}{#ifdef FLUID\_PHASE\_SIMULATIONS}
70 \textcolor{preprocessor}{}        \textcolor{keywordflow}{if} (sys.\hyperlink{classsim_system_ad2e290b5963f132e6a3a56cee35c8e9f}{ppot}[spec][\hyperlink{classmc_move_acb731965547b0326ef318ec96da8b46a}{typeIndex\_}]->useTailCorrection) \{
71             \textcolor{keywordflow}{if} (!(sys.\hyperlink{classsim_system_a299fe4372e610b554eaaf5f5957b2dbc}{getCurrentM}() > 0 && sys.\hyperlink{classsim_system_a2ab77377c60e0e3109a6e875690b0ab7}{getFractionalAtom} () == &sys.
      \hyperlink{classsim_system_a90421b19082f7fb8fc23b7264b1161e4}{atoms}[\hyperlink{classmc_move_acb731965547b0326ef318ec96da8b46a}{typeIndex\_}][a1])) \{
72                 \textcolor{comment}{// Then a1 is not the partially inserted particle and tail interactions must be included}
73                 \textcolor{keywordflow}{if} (spec == typeIndex\_) \{
74                     \textcolor{keywordflow}{if} (sys.\hyperlink{classsim_system_a9eea865e6dc1cff377b1e79c4d9c23f0}{numSpecies}[spec]-1 > 0) \{
75                         delEnergy += sys.\hyperlink{classsim_system_ad2e290b5963f132e6a3a56cee35c8e9f}{ppot}[spec][\hyperlink{classmc_move_acb731965547b0326ef318ec96da8b46a}{typeIndex\_}]->tailCorrection((sys.
      \hyperlink{classsim_system_a9eea865e6dc1cff377b1e79c4d9c23f0}{numSpecies}[spec]-1)/V);
76                     \}
77                 \} \textcolor{keywordflow}{else} \{
78                     \textcolor{keywordflow}{if} (sys.\hyperlink{classsim_system_a9eea865e6dc1cff377b1e79c4d9c23f0}{numSpecies}[spec] > 0) \{
79                         delEnergy += sys.\hyperlink{classsim_system_ad2e290b5963f132e6a3a56cee35c8e9f}{ppot}[spec][\hyperlink{classmc_move_acb731965547b0326ef318ec96da8b46a}{typeIndex\_}]->tailCorrection(sys.
      \hyperlink{classsim_system_a9eea865e6dc1cff377b1e79c4d9c23f0}{numSpecies}[spec]/V);
80                     \}
81                 \}
82             \}
83         \}
84 \textcolor{preprocessor}{#endif}
85 \textcolor{preprocessor}{}    \}
86 
87     \textcolor{comment}{// Account for wall interaction energy}
88     delEnergy += sys.\hyperlink{classsim_system_a5ae652ff4519f39c3862abae32a9581b}{speciesBarriers}[\hyperlink{classmc_move_acb731965547b0326ef318ec96da8b46a}{typeIndex\_}].energy(&sys.
      \hyperlink{classsim_system_a90421b19082f7fb8fc23b7264b1161e4}{atoms}[typeIndex\_][a1], box);
89 
90     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} spec = 0; spec < sys.\hyperlink{classsim_system_ab5e2e9b6204de15520302fe1d51688dd}{nSpecies}(); ++spec) \{
91         \textcolor{comment}{// Get positions of neighboring atoms around a2}
92         std::vector < atom* > neighborAtoms = sys.\hyperlink{classsim_system_a9b3aeefa22c3b50b5913df6eea753bc6}{getNeighborAtoms}(spec, typeIndex2\_, &sys.
      \hyperlink{classsim_system_a90421b19082f7fb8fc23b7264b1161e4}{atoms}[typeIndex2\_][a2]);
93         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} i = 0; i < neighborAtoms.size(); ++i) \{
94             \textcolor{keywordflow}{if} (neighborAtoms[i] == &sys.\hyperlink{classsim_system_a90421b19082f7fb8fc23b7264b1161e4}{atoms}[typeIndex\_][a1]) \{
95                 \textcolor{comment}{// Skip their interaction as they were already deleted - this is fine because their net
       pairwise interaction doesn't change over the course of the simulation - this means we don't have to actually
       re-insert the other atom / get its interation somehow later}
96                 \textcolor{keywordflow}{continue};
97             \} \textcolor{keywordflow}{else} \{
98                 \textcolor{keywordflow}{try} \{
99                     delEnergy += sys.\hyperlink{classsim_system_ad2e290b5963f132e6a3a56cee35c8e9f}{ppot}[spec][typeIndex2\_]->energy(neighborAtoms[i], &sys.
      \hyperlink{classsim_system_a90421b19082f7fb8fc23b7264b1161e4}{atoms}[typeIndex2\_][a2], box);
100                 \} \textcolor{keywordflow}{catch} (\hyperlink{classcustom_exception}{customException}& ce) \{
101                     std::string a = \textcolor{stringliteral}{"Cannot delete because of energy error: "}, b = ce.
      \hyperlink{classcustom_exception_aeb6ab5848b038adfc68fde86a512f691}{what}();
102                     \textcolor{keywordflow}{throw} \hyperlink{classcustom_exception}{customException} (a+b);
103                 \}
104             \}
105         \}
106         \textcolor{comment}{// Add tail correction to potential energy -- only enable for fluid phase simulations}
107 \textcolor{preprocessor}{#ifdef FLUID\_PHASE\_SIMULATIONS}
108 \textcolor{preprocessor}{}        \textcolor{keywordflow}{if} (sys.\hyperlink{classsim_system_ad2e290b5963f132e6a3a56cee35c8e9f}{ppot}[spec][typeIndex2\_]->useTailCorrection) \{
109             \textcolor{keywordflow}{if} (!(sys.\hyperlink{classsim_system_a299fe4372e610b554eaaf5f5957b2dbc}{getCurrentM}() > 0 && sys.\hyperlink{classsim_system_a2ab77377c60e0e3109a6e875690b0ab7}{getFractionalAtom} () == &sys.
      \hyperlink{classsim_system_a90421b19082f7fb8fc23b7264b1161e4}{atoms}[typeIndex2\_][a2])) \{
110                 \textcolor{comment}{// Then a2 is not the partially inserted particle and tail interactions must be included}
111                 \textcolor{keywordflow}{if} (spec == typeIndex2\_) \{
112                     \textcolor{keywordflow}{if} (sys.\hyperlink{classsim_system_a9eea865e6dc1cff377b1e79c4d9c23f0}{numSpecies}[spec]-1 > 0) \{
113                         delEnergy += sys.\hyperlink{classsim_system_ad2e290b5963f132e6a3a56cee35c8e9f}{ppot}[spec][typeIndex2\_]->tailCorrection((sys.
      \hyperlink{classsim_system_a9eea865e6dc1cff377b1e79c4d9c23f0}{numSpecies}[spec]-1)/V);
114                     \}
115                 \} \textcolor{keywordflow}{else} \{
116                     \textcolor{keywordflow}{if} (sys.\hyperlink{classsim_system_a9eea865e6dc1cff377b1e79c4d9c23f0}{numSpecies}[spec] > 0) \{
117                         delEnergy += sys.\hyperlink{classsim_system_ad2e290b5963f132e6a3a56cee35c8e9f}{ppot}[spec][typeIndex2\_]->tailCorrection(sys.
      \hyperlink{classsim_system_a9eea865e6dc1cff377b1e79c4d9c23f0}{numSpecies}[spec]/V);
118                     \}
119                 \}
120             \}
121         \}
122 \textcolor{preprocessor}{#endif}
123 \textcolor{preprocessor}{}    \}
124 
125     \textcolor{comment}{// Account for wall interaction energy}
126     delEnergy += sys.\hyperlink{classsim_system_a5ae652ff4519f39c3862abae32a9581b}{speciesBarriers}[typeIndex2\_].energy(&sys.
      \hyperlink{classsim_system_a90421b19082f7fb8fc23b7264b1161e4}{atoms}[typeIndex2\_][a2], box);
127 
128     \textcolor{keywordtype}{double} insEnergy = 0.0;
129 
130     \textcolor{comment}{// Account for wall interaction energy first to be more efficient}
131     dU = sys.\hyperlink{classsim_system_a5ae652ff4519f39c3862abae32a9581b}{speciesBarriers}[\hyperlink{classmc_move_acb731965547b0326ef318ec96da8b46a}{typeIndex\_}].energy(&a1\_new, box);
132     \textcolor{keywordflow}{if} (dU < \hyperlink{potentials_8h_ab94ab1d09e2291d03fe92a0e24a9d33b}{NUM\_INFINITY}) \{
133         insEnergy += dU;
134     \} \textcolor{keywordflow}{else} \{
135         insEnergy = \hyperlink{potentials_8h_ab94ab1d09e2291d03fe92a0e24a9d33b}{NUM\_INFINITY};
136     \}
137 
138     \textcolor{keywordflow}{if} (insEnergy < \hyperlink{potentials_8h_ab94ab1d09e2291d03fe92a0e24a9d33b}{NUM\_INFINITY}) \{
139         \textcolor{comment}{// Account for wall interaction energy}
140         dU = sys.\hyperlink{classsim_system_a5ae652ff4519f39c3862abae32a9581b}{speciesBarriers}[typeIndex2\_].energy(&a2\_new, box);
141         \textcolor{keywordflow}{if} (dU < \hyperlink{potentials_8h_ab94ab1d09e2291d03fe92a0e24a9d33b}{NUM\_INFINITY}) \{
142             insEnergy += dU;
143         \} \textcolor{keywordflow}{else} \{
144             insEnergy = \hyperlink{potentials_8h_ab94ab1d09e2291d03fe92a0e24a9d33b}{NUM\_INFINITY};
145         \}
146     \}
147 
148     \textcolor{keywordflow}{if} (insEnergy < \hyperlink{potentials_8h_ab94ab1d09e2291d03fe92a0e24a9d33b}{NUM\_INFINITY}) \{
149         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} spec = 0; spec < sys.\hyperlink{classsim_system_ab5e2e9b6204de15520302fe1d51688dd}{nSpecies}(); ++spec) \{
150             \textcolor{comment}{// Get positions of neighboring atoms around a1's (a2's) new (old) location}
151             std::vector < atom* > neighborAtoms = sys.\hyperlink{classsim_system_a9b3aeefa22c3b50b5913df6eea753bc6}{getNeighborAtoms}(spec, typeIndex\_, &
      a1\_new);
152             \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} i = 0; i < neighborAtoms.size(); ++i) \{
153                 \textcolor{comment}{// With these new "copy atoms" getNeighborAtoms can't guarantee it doesn't point to old
       self, so must check}
154                 \textcolor{keywordflow}{if} ((neighborAtoms[i] == &sys.\hyperlink{classsim_system_a90421b19082f7fb8fc23b7264b1161e4}{atoms}[typeIndex2\_][a2]) || (neighborAtoms[i] == &sys.
      \hyperlink{classsim_system_a90421b19082f7fb8fc23b7264b1161e4}{atoms}[\hyperlink{classmc_move_acb731965547b0326ef318ec96da8b46a}{typeIndex\_}][a1])) \{
155                     \textcolor{keywordflow}{continue};
156                 \} \textcolor{keywordflow}{else} \{
157                     \textcolor{keywordflow}{try} \{
158                         dU = sys.\hyperlink{classsim_system_ad2e290b5963f132e6a3a56cee35c8e9f}{ppot}[spec][\hyperlink{classmc_move_acb731965547b0326ef318ec96da8b46a}{typeIndex\_}]->energy(neighborAtoms[i], &a1\_new, 
      box);
159                     \} \textcolor{keywordflow}{catch} (\hyperlink{classcustom_exception}{customException}& ce) \{
160                         std::string a = \textcolor{stringliteral}{"Cannot insert because of energy error: "}, b = ce.
      \hyperlink{classcustom_exception_aeb6ab5848b038adfc68fde86a512f691}{what}();
161                         \textcolor{keywordflow}{throw} \hyperlink{classcustom_exception}{customException} (a+b);
162                     \}
163                     \textcolor{keywordflow}{if} (dU < \hyperlink{potentials_8h_ab94ab1d09e2291d03fe92a0e24a9d33b}{NUM\_INFINITY}) \{
164                         insEnergy += dU;
165                     \} \textcolor{keywordflow}{else} \{
166                         insEnergy = \hyperlink{potentials_8h_ab94ab1d09e2291d03fe92a0e24a9d33b}{NUM\_INFINITY};
167                         \textcolor{keywordflow}{break};
168                     \}
169                 \}
170             \}
171             \textcolor{keywordflow}{if} (insEnergy == \hyperlink{potentials_8h_ab94ab1d09e2291d03fe92a0e24a9d33b}{NUM\_INFINITY}) \textcolor{keywordflow}{break}; \textcolor{comment}{// Don't add anything if "infinite" already}
172 
173             \textcolor{comment}{// Add tail correction to potential energy -- only enable for fluid phase simulations}
174 \textcolor{preprocessor}{    #ifdef FLUID\_PHASE\_SIMULATIONS}
175 \textcolor{preprocessor}{}            \textcolor{keywordflow}{if} (sys.\hyperlink{classsim_system_ad2e290b5963f132e6a3a56cee35c8e9f}{ppot}[spec][typeIndex\_]->useTailCorrection) \{
176                 \textcolor{keywordflow}{if} (!(sys.\hyperlink{classsim_system_a299fe4372e610b554eaaf5f5957b2dbc}{getCurrentM}() > 0 && sys.\hyperlink{classsim_system_a2ab77377c60e0e3109a6e875690b0ab7}{getFractionalAtom} () == &sys
      .\hyperlink{classsim_system_a90421b19082f7fb8fc23b7264b1161e4}{atoms}[\hyperlink{classmc_move_acb731965547b0326ef318ec96da8b46a}{typeIndex\_}][a1])) \{
177                     \textcolor{comment}{// Then a1 is not the partially inserted particle and tail interactions must be
       included}
178                     \textcolor{keywordflow}{if} (spec == typeIndex\_) \{
179                         \textcolor{keywordflow}{if} (sys.\hyperlink{classsim_system_a9eea865e6dc1cff377b1e79c4d9c23f0}{numSpecies}[spec]-1 > 0) \{
180                             insEnergy += sys.\hyperlink{classsim_system_ad2e290b5963f132e6a3a56cee35c8e9f}{ppot}[spec][\hyperlink{classmc_move_acb731965547b0326ef318ec96da8b46a}{typeIndex\_}]->tailCorrection((sys.
      \hyperlink{classsim_system_a9eea865e6dc1cff377b1e79c4d9c23f0}{numSpecies}[spec]-1)/V); \textcolor{comment}{// Never infinite}
181                         \}
182                     \} \textcolor{keywordflow}{else} \{
183                         \textcolor{keywordflow}{if} (sys.\hyperlink{classsim_system_a9eea865e6dc1cff377b1e79c4d9c23f0}{numSpecies}[spec] > 0) \{
184                             insEnergy += sys.\hyperlink{classsim_system_ad2e290b5963f132e6a3a56cee35c8e9f}{ppot}[spec][\hyperlink{classmc_move_acb731965547b0326ef318ec96da8b46a}{typeIndex\_}]->tailCorrection(sys.
      \hyperlink{classsim_system_a9eea865e6dc1cff377b1e79c4d9c23f0}{numSpecies}[spec]/V); \textcolor{comment}{// Never infinite}
185                         \}
186                     \}
187                 \}
188             \}
189 \textcolor{preprocessor}{    #endif}
190 \textcolor{preprocessor}{}        \}
191     \}
192 
193     \textcolor{keywordflow}{if} (insEnergy < \hyperlink{potentials_8h_ab94ab1d09e2291d03fe92a0e24a9d33b}{NUM\_INFINITY}) \{
194         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} spec = 0; spec < sys.\hyperlink{classsim_system_ab5e2e9b6204de15520302fe1d51688dd}{nSpecies}(); ++spec) \{
195             \textcolor{comment}{// Get positions of neighboring atoms around a2's (a1's) new (old) location}
196             std::vector < atom* > neighborAtoms = sys.\hyperlink{classsim_system_a9b3aeefa22c3b50b5913df6eea753bc6}{getNeighborAtoms}(spec, typeIndex2\_, &
      a2\_new);
197             \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} i = 0; i < neighborAtoms.size(); ++i) \{
198                 \textcolor{keywordflow}{if} ((neighborAtoms[i] == &sys.\hyperlink{classsim_system_a90421b19082f7fb8fc23b7264b1161e4}{atoms}[typeIndex\_][a1]) || (neighborAtoms[i] == &sys.
      \hyperlink{classsim_system_a90421b19082f7fb8fc23b7264b1161e4}{atoms}[typeIndex2\_][a2])) \{
199                     \textcolor{keywordflow}{continue};
200                 \} \textcolor{keywordflow}{else} \{
201                     \textcolor{keywordflow}{try} \{
202                         dU = sys.\hyperlink{classsim_system_ad2e290b5963f132e6a3a56cee35c8e9f}{ppot}[spec][typeIndex2\_]->energy(neighborAtoms[i], &a2\_new, box);
203                     \} \textcolor{keywordflow}{catch} (\hyperlink{classcustom_exception}{customException}& ce) \{
204                         std::string a = \textcolor{stringliteral}{"Cannot insert because of energy error: "}, b = ce.
      \hyperlink{classcustom_exception_aeb6ab5848b038adfc68fde86a512f691}{what}();
205                         \textcolor{keywordflow}{throw} \hyperlink{classcustom_exception}{customException} (a+b);
206                     \}
207                     \textcolor{keywordflow}{if} (dU < \hyperlink{potentials_8h_ab94ab1d09e2291d03fe92a0e24a9d33b}{NUM\_INFINITY}) \{
208                         insEnergy += dU;
209                     \} \textcolor{keywordflow}{else} \{
210                         insEnergy = \hyperlink{potentials_8h_ab94ab1d09e2291d03fe92a0e24a9d33b}{NUM\_INFINITY};
211                         \textcolor{keywordflow}{break};
212                     \}
213                 \}
214             \}
215             \textcolor{keywordflow}{if} (insEnergy == \hyperlink{potentials_8h_ab94ab1d09e2291d03fe92a0e24a9d33b}{NUM\_INFINITY}) \textcolor{keywordflow}{break}; \textcolor{comment}{// Don't add anything if "infinite" already}
216 
217             \textcolor{comment}{// Add tail correction to potential energy -- only enable for fluid phase simulations}
218 \textcolor{preprocessor}{    #ifdef FLUID\_PHASE\_SIMULATIONS}
219 \textcolor{preprocessor}{}            \textcolor{keywordflow}{if} (sys.\hyperlink{classsim_system_ad2e290b5963f132e6a3a56cee35c8e9f}{ppot}[spec][typeIndex2\_]->useTailCorrection) \{
220                 \textcolor{keywordflow}{if} (!(sys.\hyperlink{classsim_system_a299fe4372e610b554eaaf5f5957b2dbc}{getCurrentM}() > 0 && sys.\hyperlink{classsim_system_a2ab77377c60e0e3109a6e875690b0ab7}{getFractionalAtom} () == &sys
      .\hyperlink{classsim_system_a90421b19082f7fb8fc23b7264b1161e4}{atoms}[typeIndex2\_][a2])) \{
221                     \textcolor{comment}{// Then a2 is not the partially inserted particle and tail interactions must be
       included}
222                     \textcolor{keywordflow}{if} (spec == typeIndex2\_) \{
223                         \textcolor{keywordflow}{if} (sys.\hyperlink{classsim_system_a9eea865e6dc1cff377b1e79c4d9c23f0}{numSpecies}[spec]-1 > 0) \{
224                             insEnergy += sys.\hyperlink{classsim_system_ad2e290b5963f132e6a3a56cee35c8e9f}{ppot}[spec][typeIndex2\_]->tailCorrection((sys.
      \hyperlink{classsim_system_a9eea865e6dc1cff377b1e79c4d9c23f0}{numSpecies}[spec]-1)/V); \textcolor{comment}{// Never infinite}
225                         \}
226                     \} \textcolor{keywordflow}{else} \{
227                         \textcolor{keywordflow}{if} (sys.\hyperlink{classsim_system_a9eea865e6dc1cff377b1e79c4d9c23f0}{numSpecies}[spec] > 0) \{
228                             insEnergy += sys.\hyperlink{classsim_system_ad2e290b5963f132e6a3a56cee35c8e9f}{ppot}[spec][typeIndex2\_]->tailCorrection(sys.
      \hyperlink{classsim_system_a9eea865e6dc1cff377b1e79c4d9c23f0}{numSpecies}[spec]/V); \textcolor{comment}{// Never infinite}
229                         \}
230                     \}
231                 \}
232             \}
233 \textcolor{preprocessor}{    #endif}
234 \textcolor{preprocessor}{}        \}
235     \}
236 
237     \textcolor{comment}{// Biasing}
238     \textcolor{keywordtype}{double} p\_u = 0.0;
239     \textcolor{keywordflow}{if} (insEnergy < \hyperlink{potentials_8h_ab94ab1d09e2291d03fe92a0e24a9d33b}{NUM\_INFINITY}) \{
240         p\_u = exp(-sys.\hyperlink{classsim_system_a3eeec9678902f8d7fce4dad6064aaf4c}{beta}()*(insEnergy - delEnergy));
241     \}
242     \textcolor{keywordtype}{double} bias = \hyperlink{system_8cpp_acfe185adf03db047fd3753c0d788e0e3}{calculateBias}(sys, sys.\hyperlink{classsim_system_a37dd827f4057049763351510147b9f1d}{getTotN}(), sys.
      \hyperlink{classsim_system_a299fe4372e610b554eaaf5f5957b2dbc}{getCurrentM}());
243 
244     \textcolor{comment}{// TMMC gets updated the same way, regardless of whether the move gets accepted}
245     \textcolor{keywordflow}{if} (sys.\hyperlink{classsim_system_aa474a50b6353c8897331b1ab1ce53ab1}{useTMMC}) \{
246         sys.\hyperlink{classsim_system_a13173f45a1e40a5f5a3552b0ebe15b54}{tmmcBias}->\hyperlink{classtmmc_ae067afc5b52af203b9d45f18d9737219}{updateC} (sys.\hyperlink{classsim_system_a37dd827f4057049763351510147b9f1d}{getTotN}(), sys.\hyperlink{classsim_system_a37dd827f4057049763351510147b9f1d}{getTotN}(), sys.
      \hyperlink{classsim_system_a299fe4372e610b554eaaf5f5957b2dbc}{getCurrentM}(), sys.\hyperlink{classsim_system_a299fe4372e610b554eaaf5f5957b2dbc}{getCurrentM}(), std::min(1.0, p\_u));
247     \}
248 
249     \textcolor{keywordflow}{if} (\hyperlink{utilities_8cpp_a0f9542af4b475ac79cb679d7a8d14db0}{rng} (&\hyperlink{global_8h_a3f4e4ea24d5a5c66feae55d1f329c884}{RNG\_SEED}) < p\_u*bias) \{ \textcolor{comment}{// Swap the particles by deleting/reinserting}
250         sys.\hyperlink{classsim_system_a6ad31c08955b80873f865b3069618dcb}{incrementEnergy}(insEnergy - delEnergy);
251 
252         \textcolor{comment}{// -a1 completely}
253         \textcolor{keywordflow}{try} \{
254             sys.\hyperlink{classsim_system_acabf4fc5b5b90bba62e1449ddb3646c6}{deleteAtom}(typeIndex\_, a1, \textcolor{keyword}{true});
255         \} \textcolor{keywordflow}{catch} (\hyperlink{classcustom_exception}{customException} &ce) \{
256             std::string a = \textcolor{stringliteral}{"Failed to delete atom during swapping: "}, b = ce.
      \hyperlink{classcustom_exception_aeb6ab5848b038adfc68fde86a512f691}{what}();
257             \textcolor{keywordflow}{throw} \hyperlink{classcustom_exception}{customException} (a+b);
258         \}
259 
260         \textcolor{comment}{// -a2 completely}
261         \textcolor{keywordflow}{try} \{
262             sys.\hyperlink{classsim_system_acabf4fc5b5b90bba62e1449ddb3646c6}{deleteAtom}(typeIndex2\_, a2, \textcolor{keyword}{true});
263         \} \textcolor{keywordflow}{catch} (\hyperlink{classcustom_exception}{customException} &ce) \{
264             std::string a = \textcolor{stringliteral}{"Failed to delete atom during swapping: "}, b = ce.
      \hyperlink{classcustom_exception_aeb6ab5848b038adfc68fde86a512f691}{what}();
265             \textcolor{keywordflow}{throw} \hyperlink{classcustom_exception}{customException} (a+b);
266         \}
267 
268         \textcolor{comment}{// +a1\_new completely}
269         \textcolor{keywordflow}{try} \{
270             sys.\hyperlink{classsim_system_a0404e9435cc046d19b6bb990678ee069}{insertAtom}(typeIndex\_, &a1\_new, \textcolor{keyword}{true});
271         \} \textcolor{keywordflow}{catch} (\hyperlink{classcustom_exception}{customException} &ce) \{
272             std::string a = \textcolor{stringliteral}{"Failed to insert atom during swapping: "}, b = ce.
      \hyperlink{classcustom_exception_aeb6ab5848b038adfc68fde86a512f691}{what}();
273             \textcolor{keywordflow}{throw} \hyperlink{classcustom_exception}{customException} (a+b);
274         \}
275 
276         \textcolor{comment}{// +a2\_new completely}
277         \textcolor{keywordflow}{try} \{
278             sys.\hyperlink{classsim_system_a0404e9435cc046d19b6bb990678ee069}{insertAtom}(typeIndex2\_, &a2\_new, \textcolor{keyword}{true});
279         \} \textcolor{keywordflow}{catch} (\hyperlink{classcustom_exception}{customException} &ce) \{
280             std::string a = \textcolor{stringliteral}{"Failed to insert atom during swapping: "}, b = ce.
      \hyperlink{classcustom_exception_aeb6ab5848b038adfc68fde86a512f691}{what}();
281             \textcolor{keywordflow}{throw} \hyperlink{classcustom_exception}{customException} (a+b);
282         \}
283 
284         \textcolor{comment}{// Update Wang-Landau bias, if used}
285         \textcolor{keywordflow}{if} (sys.\hyperlink{classsim_system_aa83b00006b3919fb6e13f1bdeadece6a}{useWALA}) \{
286             sys.\hyperlink{classsim_system_a7cb5049de8b0988349e89e30e4000407}{getWALABias}()->\hyperlink{classwala_ab439e3f60bea6c54522a870b9ad67acf}{update}(sys.\hyperlink{classsim_system_a37dd827f4057049763351510147b9f1d}{getTotN}(), sys.
      \hyperlink{classsim_system_a299fe4372e610b554eaaf5f5957b2dbc}{getCurrentM}());
287         \}
288         \textcolor{keywordflow}{return} \hyperlink{moves_8h_ae8285cbddc5d21f73f49dcbad82a775a}{MOVE\_SUCCESS};
289     \}
290 
291     \textcolor{comment}{// Update Wang-Landau bias (even if moved failed), if used}
292     \textcolor{keywordflow}{if} (sys.\hyperlink{classsim_system_aa83b00006b3919fb6e13f1bdeadece6a}{useWALA}) \{
293         sys.\hyperlink{classsim_system_a7cb5049de8b0988349e89e30e4000407}{getWALABias}()->\hyperlink{classwala_ab439e3f60bea6c54522a870b9ad67acf}{update}(sys.\hyperlink{classsim_system_a37dd827f4057049763351510147b9f1d}{getTotN}(), sys.
      \hyperlink{classsim_system_a299fe4372e610b554eaaf5f5957b2dbc}{getCurrentM}());
294     \}
295 
296     \textcolor{keywordflow}{return} \hyperlink{moves_8h_a9832cf5fcfa8c0894545b591c9908e39}{MOVE\_FAILURE};
297 \}
\end{DoxyCode}


The documentation for this class was generated from the following files\-:\begin{DoxyCompactItemize}
\item 
/home/nam4/\-Desktop/sandbox/\-F\-H\-M\-C\-Simulation/src/\hyperlink{swap_8h}{swap.\-h}\item 
/home/nam4/\-Desktop/sandbox/\-F\-H\-M\-C\-Simulation/src/\hyperlink{swap_8cpp}{swap.\-cpp}\end{DoxyCompactItemize}
